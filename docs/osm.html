<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.8">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Open Data sources – 2&nbsp; OpenStreetMap as a universal spatial data source</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./environments.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./osm.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">OpenStreetMap as a universal spatial data source</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Open Data sources</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/gsapijaszko/open_data" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./osm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">OpenStreetMap as a universal spatial data source</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environmental data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-access-and-available-formats" id="toc-data-access-and-available-formats" class="nav-link active" data-scroll-target="#data-access-and-available-formats"><span class="header-section-number">2.1</span> Data access and available formats</a>
  <ul>
  <li><a href="#osmextract" id="toc-osmextract" class="nav-link" data-scroll-target="#osmextract"><span class="header-section-number">2.1.1</span> osmextract</a></li>
  <li><a href="#osmdata" id="toc-osmdata" class="nav-link" data-scroll-target="#osmdata"><span class="header-section-number">2.1.2</span> osmdata</a></li>
  </ul></li>
  <li><a href="#boundaries" id="toc-boundaries" class="nav-link" data-scroll-target="#boundaries"><span class="header-section-number">2.2</span> Boundaries</a>
  <ul>
  <li><a href="#administrative-boundaries" id="toc-administrative-boundaries" class="nav-link" data-scroll-target="#administrative-boundaries"><span class="header-section-number">2.2.1</span> Administrative boundaries</a></li>
  <li><a href="#below-country-level" id="toc-below-country-level" class="nav-link" data-scroll-target="#below-country-level"><span class="header-section-number">2.2.2</span> Below country level</a></li>
  <li><a href="#other-kind-of-boundaries" id="toc-other-kind-of-boundaries" class="nav-link" data-scroll-target="#other-kind-of-boundaries"><span class="header-section-number">2.2.3</span> Other kind of boundaries</a>
  <ul class="collapse">
  <li><a href="#protected-areas" id="toc-protected-areas" class="nav-link" data-scroll-target="#protected-areas">Protected areas</a></li>
  <li><a href="#sec-postal_code" id="toc-sec-postal_code" class="nav-link" data-scroll-target="#sec-postal_code">Postal code areas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-land_coverage" id="toc-sec-land_coverage" class="nav-link" data-scroll-target="#sec-land_coverage"><span class="header-section-number">2.3</span> Land coverage and use</a></li>
  <li><a href="#where-the-streets-have-no-names" id="toc-where-the-streets-have-no-names" class="nav-link" data-scroll-target="#where-the-streets-have-no-names"><span class="header-section-number">2.4</span> Where the streets have no names</a>
  <ul>
  <li><a href="#bike-infrastructure" id="toc-bike-infrastructure" class="nav-link" data-scroll-target="#bike-infrastructure"><span class="header-section-number">2.4.1</span> Bike infrastructure</a>
  <ul class="collapse">
  <li><a href="#other-features" id="toc-other-features" class="nav-link" data-scroll-target="#other-features">Other features</a></li>
  <li><a href="#bicycle-routes" id="toc-bicycle-routes" class="nav-link" data-scroll-target="#bicycle-routes">Bicycle routes</a></li>
  </ul></li>
  <li><a href="#routing-and-accessibility" id="toc-routing-and-accessibility" class="nav-link" data-scroll-target="#routing-and-accessibility"><span class="header-section-number">2.4.2</span> Routing and accessibility</a></li>
  </ul></li>
  <li><a href="#power-grid" id="toc-power-grid" class="nav-link" data-scroll-target="#power-grid"><span class="header-section-number">2.5</span> Power grid</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/gsapijaszko/open_data/edit/main/osm.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/gsapijaszko/open_data/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-openstreetmap" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">OpenStreetMap as a universal spatial data source</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
OSM Data at a glance
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Lorem ipsum</p>
<p>Detailed statistics in csv https://blackadder.dev.openstreetmap.org/OSMStats/</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://blackadder.dev.openstreetmap.org/OSMStats/"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(url) <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_table</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> t[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">grepl</span>(<span class="st">".csv"</span>, Name), <span class="at">select =</span> <span class="fu">c</span>(Name, <span class="st">`</span><span class="at">Last modified</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">substr</span>(<span class="st">`</span><span class="at">Last modified</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">10</span>))) <span class="sc">|&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">1</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>osm_stats <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(url, f<span class="sc">$</span>Name))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> osm_stats <span class="sc">|&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Day.of.Month =</span> <span class="fu">as.Date</span>(Day.of.Month, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">format</span>(Day.of.Month, <span class="st">"%d"</span>) <span class="sc">==</span> <span class="st">"01"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p<span class="sc">$</span>Day.of.Month, p<span class="sc">$</span>Users,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">18</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="st">"y"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    lubridate<span class="sc">::</span><span class="fu">as_date</span>(<span class="st">"2005-01-01"</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    lubridate<span class="sc">::</span><span class="fu">as_date</span>(<span class="st">"2025-01-01"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"year"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">""</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p<span class="sc">$</span>Day.of.Month, p<span class="sc">$</span>Nodes.editors.week)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"# of users"</span>, <span class="st">"# of nodes editors/week"</span>),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">text.col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"black"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-number_of_editors" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-number_of_editors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-number_of_editors-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-number_of_editors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Number of editors (blue) and number of nodes per editor/week (black) based on statistics available online <a href="https://blackadder.dev.openstreetmap.org/OSMStats/">https://blackadder.dev.openstreetmap.org/OSMStats/</a>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>OpenStreetMap has grown enormously. It’s data is used quite often by researchers of various fields. File <code>data/OpenStreetMap.bib</code> contains bibliography where either OSM, OpenStreetMap or Volunteered Geographic Information appears in title and/or abstract. The articled published in first years concentrated mostly on data quality and volunteered phenomenon of spatial data collection. Few years later we can observe shift from assessment to use of the OSM data as base spatial set in the analyses. <a href="#fig-osm_bibliography_per_year" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> display the number of scientific papers by year, while <a href="#fig-osm_most_common_words" class="quarto-xref">Figure&nbsp;<span>2.3</span></a> shows most common words used in titles.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-osm_bibliography_per_year" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-osm_bibliography_per_year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-osm_bibliography_per_year-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-osm_bibliography_per_year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: OpenStreetMap related bibliography by year
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-osm_most_common_words" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-osm_most_common_words-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-osm_most_common_words-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-osm_most_common_words-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Most common words in OSM bibliography
</figcaption>
</figure>
</div>
</div>
</div>
<p>Data quality was assessed in various scientific studies, beginning with the comparison of OSM roads network with official data sets. <span class="citation" data-cites="haklayHowGoodVolunteered2010">Haklay (<a href="references.html#ref-haklayHowGoodVolunteered2010" role="doc-biblioref">2010</a>)</span> conducted a study for England, while <span class="citation" data-cites="kounadiAssessingQualityOpenStreetMap2009">Kounadi (<a href="references.html#ref-kounadiAssessingQualityOpenStreetMap2009" role="doc-biblioref">2009</a>)</span> focused on Athens, Greece, examining positional accuracy, completeness and thematic accuracy. Subsequent studies such as <span class="citation" data-cites="zielstraQuantitativeStudiesData2010">Zielstra and Zipf (<a href="references.html#ref-zielstraQuantitativeStudiesData2010" role="doc-biblioref">2010</a>)</span>, <span class="citation" data-cites="ludwigComparisonStreetNetworks2011">Ludwig, Voss, and Krause-Traudes (<a href="references.html#ref-ludwigComparisonStreetNetworks2011" role="doc-biblioref">2011</a>)</span> and <span class="citation" data-cites="neisStreetNetworkEvolution2011">Neis, Zielstra, and Zipf (<a href="references.html#ref-neisStreetNetworkEvolution2011" role="doc-biblioref">2011</a>)</span> delved into the quality of the road network in Germany.</p>
<p>The quality of other features has also been assessed. For instance, <span class="citation" data-cites="mooneyStudyDataRepresentation2010">Mooney, Corcoran, and Winstanley (<a href="references.html#ref-mooneyStudyDataRepresentation2010" role="doc-biblioref">2010</a>)</span> compared land cover data with Ordnance Survey Ireland, while <span class="citation" data-cites="girresQualityAssessmentFrench2010">Girres and Touya (<a href="references.html#ref-girresQualityAssessmentFrench2010" role="doc-biblioref">2010</a>)</span> evaluated data quality principles in accordance with <a href="https://www.iso.org/standard/26018.html">ISO 19113:2002</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> for France.</p>
<section id="data-access-and-available-formats" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-access-and-available-formats"><span class="header-section-number">2.1</span> Data access and available formats</h2>
<p>There are several ways to access the OpenStreetMap data. The entire planet data, currently approximately 73 GB in a binary (packed) PBF file, can be downloaded from planet.osm <span class="citation" data-cites="PlanetOSM">(<a href="references.html#ref-PlanetOSM" role="doc-biblioref"><span>“Planet <span>OSM</span>”</span> 2024</a>)</span>. Alternatively, smaller snapshots can be obtained from <a href="http://download.geofabrik.de/">GeoFabrik.de</a> or <a href="https://download.bbbike.org/osm/">BBBike.org</a>. Those sources provide data in OSM XML and/or PBF formats. Subsequently, tools like <a href="https://osm2pgsql.org/"><code>osm2pgsql</code></a> can be used to import the data into Postgresql/PostGIS database, <a href="https://wiki.openstreetmap.org/wiki/Osmosis"><code>osmosis</code></a> for data manipulation and filtering, or QGIS for direct processing.</p>
<p>For those seeking direct access to the data, the <a href="https://www.overpass-api.de/">Overpass API</a> is available with <a href="https://overpass-turbo.eu/">Overpass Turbo</a> serving as a front-end where users can build and execute the queries instantly. Further details about data access are described on the <a href="https://wiki.openstreetmap.org/wiki/Planet.osm">wiki</a>.</p>
<p>To access OSM spatial data from R, there are several libraries available. The {osmextract} <span class="citation" data-cites="osmextract">(<a href="references.html#ref-osmextract" role="doc-biblioref">Gilardi and Lovelace 2023</a>)</span> library enables the download and import data extracts, for instance, from GeoFabrik. Additionally, the {osmdata} package <span class="citation" data-cites="osmdata">(<a href="references.html#ref-osmdata" role="doc-biblioref">Mark Padgham et al. 2017</a>)</span> can be utilized, which leverages the Overpass API to import data as Simple Features {sf} or Spatial Objects {sp}.</p>
<section id="osmextract" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="osmextract"><span class="header-section-number">2.1.1</span> osmextract</h3>
<p>As the name suggest, the package allows you to search, download and process the data extracts available online. Per default it uses 3 providers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_providers</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Check the corresponding help pages to read more details about the fields in each database (e.g. ?geofabrik_zones).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  available_providers          database_name number_of_zones number_of_fields
1           geofabrik        geofabrik_zones             475                8
2              bbbike           bbbike_zones             236                5
3    openstreetmap_fr openstreetmap_fr_zones            1135                6</code></pre>
</div>
</div>
<p>Each of these providers has a specific set of areas, for example BBBike.org offers data sets for the biggest cities around the globe, while GeoFabrik.de and openstreetmap.fr cover the entire world. <a href="#fig-oe_provider_zones" class="quarto-xref">Figure&nbsp;<span>2.4</span></a> visualizes the areas covered by these providers. The typical workflow consists of few steps:</p>
<ul>
<li>Find the area of interest by matching it with one of the files/areas stored by providers using <code>oe_match()</code>;</li>
<li>Download the <code>.pbf</code> file with <code>oe_download()</code>;</li>
<li>Convert the <code>.pbf</code> file to <code>.gpkg</code> file with <code>oe_vectortranslate()</code>;</li>
<li>Read the data using <code>oe_read()</code> function.</li>
</ul>
<p><a href="#sec-postal_code" class="quarto-xref"><span>Section 2.2.3.2</span></a> shows an example of {osmextract} usage for postal code areas around Leipzig, Germany.</p>
<div id="fig-oe_provider_zones" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oe_provider_zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-oe_provider_zones" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-oe_provider_zones-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-oe_provider_zones-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-oe_provider_zones-1.png" class="img-fluid figure-img" data-ref-parent="fig-oe_provider_zones" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-oe_provider_zones-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) BBBike.org
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-oe_provider_zones" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-oe_provider_zones-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-oe_provider_zones-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-oe_provider_zones-2.png" class="img-fluid figure-img" data-ref-parent="fig-oe_provider_zones" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-oe_provider_zones-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) GeoFabrik.de
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-oe_provider_zones" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-oe_provider_zones-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-oe_provider_zones-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-oe_provider_zones-3.png" class="img-fluid figure-img" data-ref-parent="fig-oe_provider_zones" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-oe_provider_zones-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) openstreetmap.fr
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oe_provider_zones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Area covered by different providers.
</figcaption>
</figure>
</div>
</section>
<section id="osmdata" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="osmdata"><span class="header-section-number">2.1.2</span> osmdata</h3>
<p>The {osmdata} package enables the construction of a query to retrieve data from Overpass server. The initial step involves creating a bounding box around the geographical area of interest. The <code>getbb()</code> function serves as a helper; it queries the Nominatim service for coordinates and downloads the bounding box for the specified location, as demonstrated in our example with the Czech Republic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"Czech Republic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default it returns a data in <code>matrix</code> form, like:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       min      max
x 12.09058 18.85925
y 48.55181 51.05569</code></pre>
</div>
</div>
<p>The subsequent step involves generating an Overpass query using the <code>opq()</code> function, which searches for requested features within the specified bounding box. By utilizing <code>add_osm_feature()</code> function and specifying key-value pairs, we narrow down the search criteria. In our example, we focus on administrative boundaries at the 2nd level (corresponding to countries) and further narrow it to Czechia. The pipe <code>|&gt;</code> functions as the <strong>AND</strong> operator in the query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="at">bbox =</span> b, <span class="at">timeout =</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name:en"</span>, <span class="at">value =</span> <span class="st">"Czechia"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The OSM data set is extensive as Overpass returns all points, (multi)lines and (multi)polygons that are ‘touched’ by the query. Upon examining the <code>osm</code> object returned, we observe the details: 125 k points, 1 k linestrings and 1 multipolygon which constitutes the country.</p>
<pre><code>Object of class 'osmdata' with:
               $bbox : 48.5518081,12.0905752,51.0556945,18.8592538
      $overpass_call : The call submitted to the overpass API
               $meta : metadata including timestamp and version numbers
         $osm_points : 'sf' Simple Features Collection with 125030 points
          $osm_lines : 'sf' Simple Features Collection with 1009 linestrings
       $osm_polygons : 'sf' Simple Features Collection with 0 polygons
     $osm_multilines : NULL
  $osm_multipolygons : 'sf' Simple Features Collection with 1 multipolygons</code></pre>
<p>Each variable contain particular set of features like points, (multi)lines or (multi)polygons. We can access them directly using <code>osm$osm_...</code> like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>osm<span class="sc">$</span>osm_points <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"geometry"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 13.04717 ymin: 49.26365 xmax: 14.23419 ymax: 50.88782
Geodetic CRS:  WGS 84
           osm_id                                        name
27300178 27300178                          Schmilka - Hřensko
28310825 28310825 Hraniční přechod Svatá Kateřina - Rittsteig
                          geometry
27300178 POINT (14.23419 50.88782)
28310825 POINT (13.04717 49.26365)</code></pre>
</div>
</div>
<p>Corresponding <a href="https://overpass-turbo.eu/s/1FS3">Overpass query</a> for Czech Republic boundary looks like:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="er">out:json</span><span class="ot">][</span><span class="er">timeout:</span><span class="dv">25</span><span class="ot">]</span><span class="er">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">relation</span><span class="ot">[</span><span class="er">boundary=administrative</span><span class="ot">]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="er">admin_level=</span><span class="dv">2</span><span class="ot">][</span><span class="st">"name:en"</span><span class="er">='Czechia'</span><span class="ot">]</span><span class="er">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="er">out</span> <span class="er">geom;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="boundaries" class="level2 page-columns page-full" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="boundaries"><span class="header-section-number">2.2</span> Boundaries</h2>
<section id="administrative-boundaries" class="level3 page-columns page-full" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="administrative-boundaries"><span class="header-section-number">2.2.1</span> Administrative boundaries</h3>
<p>Let’s proceed with our straightforward example of OSM-based spatial data: administrative boundaries. Typically, administrative areas are depicted as polygons, with their geometries highlighted by color or the shape of their borders. The examples of administrative borders are illustrated in the <a href="#fig-borders-example" class="quarto-xref">Figure&nbsp;<span>2.5</span></a>.</p>
<div id="fig-borders-example" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-borders-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/auto_map_poland_1937.png" class="img-fluid figure-img"></p>
<figcaption>Boder between Germany and Poland, on Polish auto map, 1937</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fragment_KARTA_KRALJEVINA_SRBA_HRVATA_I_SLOVENACA_750K_1924_nj420ct1196.png" class="img-fluid figure-img"></p>
<figcaption>Boders in Serbia, Chorvatia and Slovenia, 1924</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-borders-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Examples of country boundaries on different maps, source: <a href="http://english.mapywig.org">Archiwum Map WIG 1919-1939</a>
</figcaption>
</figure>
</div>
<p>There are several openly available datasets that offer administrative boundaries, such as <code>world</code> country polygons from the {spData} package <span class="citation" data-cites="spData">(<a href="references.html#ref-spData" role="doc-biblioref">Bivand, Nowosad, and Lovelace 2023</a>)</span>, Natural Earth<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> accessible via {rnaturalearthdata} package <span class="citation" data-cites="rnaturalearthdata">(<a href="references.html#ref-rnaturalearthdata" role="doc-biblioref">South 2017</a>)</span>, {geodata} <span class="citation" data-cites="geodata">(<a href="references.html#ref-geodata" role="doc-biblioref">Hijmans et al. 2023</a>)</span>, etc. For those who like point-and-click, there is a <a href="https://osm-boundaries.com/">osm-boundaries.com</a> service, where you can pick the boundaries and download it in few different formats including GeoJSON. <a href="#fig-osm-czech-boundary" class="quarto-xref">Figure&nbsp;<span>2.6</span></a> displays few sets of freely available boundary data for a section of the Czech Republic boundary. You may observe a significant difference between these lines and the administrative boundary from the OpenStreetMap map layer below. Despite both datasets being prepared based on OSM data, they have undergone simplification. Please exercise caution when selecting your data set and utilize it judiciously.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"World"</span>, <span class="at">package =</span> <span class="st">"tmap"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> World <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(iso_a3 <span class="sc">==</span> <span class="st">"CZE"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>cze <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">gadm</span>(<span class="st">"CZE"</span>, <span class="at">level =</span> <span class="dv">0</span>, <span class="at">path =</span> <span class="st">"data"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>b_box <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">16</span>, <span class="at">ymin =</span> <span class="fl">50.1</span>, <span class="at">xmax =</span> <span class="fl">17.2</span>, <span class="at">ymax =</span> <span class="fl">50.6</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>tmpl <span class="ot">&lt;-</span> tmap<span class="sc">::</span><span class="fu">tm_shape</span>(c, <span class="at">bbox =</span> b_box) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(cze) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>tmpl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-osm-czech-boundary" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-osm-czech-boundary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/osm_boundary-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-osm-czech-boundary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Different boundary lines shown on OSM background: <code>World</code> data set from {tmap} package <span class="citation" data-cites="tmap">(<a href="references.html#ref-tmap" role="doc-biblioref">Tennekes 2018</a>)</span> <span style="color:orange;">in orange</span> and Czech Republic administrative boundary data from <a href="https://gadm.org/">GADM</a> by {geodata} package <span style="color:blue;">in blue</span>.
</figcaption>
</figure>
</div>
<p>Let’s add the data extracted with {osmdata} to our previous plot:</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>osm <span class="ot">&lt;-</span> osm <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> osm<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"geometry"</span>)) </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>tmpl <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(d) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-osmdata-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-osmdata-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/osmdata_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-osmdata-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: And with Czech Republic boundary based on OpenStreetMap data (<span style="color:darkgreen;">green</span>).
</figcaption>
</figure>
</div>
<p>Please note the distinction. It’s worth highlighting that the boundary obtained from the <code>geodata::gadm()</code> function is quite close to the original OSM line. Sometimes, simplicity translates to quicker outcomes. The choice of which data set to use depends entirely on the intended purpose and the desired level of accuracy.</p>
<p>It’s important to note that there are countries, such as Italy, whose borders incorporate territorial waters.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>it_bbox <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"Italy"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>it <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="at">bbox =</span> it_bbox, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name:en"</span>, <span class="at">value =</span> <span class="st">"Italy"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>it_border <span class="ot">&lt;-</span> it<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(name <span class="sc">==</span> <span class="st">"Italia"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(it_border) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_basemap</span>(<span class="st">"OpenStreetMap"</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"orange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-italy_with_territorial_waters" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-italy_with_territorial_waters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/italy_with_territorial_waters-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-italy_with_territorial_waters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.8: Border of the Italy including territorial waters
</figcaption>
</figure>
</div>
<p>If there is a requirement to preserve landmass only boundaries, a useful ‘trick’ is to download lower-level areas and then combine them. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>it_regions <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="at">bbox =</span> it_bbox, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"4"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"ISO3166-2"</span>, <span class="at">value =</span> <span class="st">"IT"</span>, <span class="at">value_exact =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>it_land <span class="ot">&lt;-</span> it_regions<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(admin_level <span class="sc">==</span> <span class="dv">4</span>, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">"name"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-italy_without_water" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-italy_without_water-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/it_level4_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-italy_without_water-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.9: Italy land border created with gluing the lower administrative boundaries with <code>st_union()</code>.
</figcaption>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://overpass-turbo.eu/s/1FeW">Overpass query</a></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="er">out:json</span><span class="ot">][</span><span class="er">timeout:</span><span class="dv">25</span><span class="ot">]</span><span class="er">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="er">{geocodeArea</span><span class="fu">:</span><span class="er">Italy</span><span class="fu">}</span><span class="er">};</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">relation</span><span class="ot">[</span><span class="er">admin_level=</span><span class="dv">4</span><span class="ot">]</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="er">boundary=administrative</span><span class="ot">]</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">"ISO3166-2"</span><span class="er">~</span><span class="st">"IT-"</span><span class="ot">]</span><span class="er">(area);</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="er">out</span> <span class="er">geom;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div><p>Such trick will work for some countries like Italy, France or Spain, however it will not for all of them because their lower level boundaries may also include territorial waters like in Poland or Germany. For other countries you can try to use other <code>admin_level</code> (i.e.&nbsp;7 for Greece will work). To deal with such <em>issue</em> one can use water polygons<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and subtract it from boundaries.</p>
</section>
<section id="below-country-level" class="level3 page-columns page-full" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="below-country-level"><span class="header-section-number">2.2.2</span> Below country level</h3>
<p>Sub-national borders like province, state, region, district, parish, municipality or any other country-specific administrative areas are marked with <code>admin_level = 3</code> to <code>11</code>. The details for almost all countries can be found on <a href="https://wiki.openstreetmap.org/wiki/Tag:boundary%3Dadministrative#admin_level=*_Country_specific_values">wiki</a>, but there is a general pattern across OSM data:</p>
<div class="cell">
<div id="tbl-admin_levels" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-admin_levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: General administrative levels of OSM boundaries
</figcaption>
<div aria-describedby="tbl-admin_levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">admin_level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">provinces, regions, prefectures</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">counties, regions</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">municipalities, towns</td>
</tr>
<tr class="even">
<td style="text-align: right;">8-9</td>
<td style="text-align: left;">villages, parts of town</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>The <code>geodata::gadm()</code> function allows to get the administrative boundaries up to municipality level, like the below example for Poland:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">gadm</span>(<span class="st">"Poland"</span>, <span class="at">level =</span> <span class="dv">3</span>, <span class="at">path =</span> <span class="st">"data"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(pl[<span class="st">"GID_3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/gadm_3_poland-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>But what, if we want to go deeper with our analysis and look on single villages or even hamlets within one municipality? Let’s try it on municipality of Prusice, Lower Silesia, Poland. After getting the bounding box we are requesting <code>boundary = administrative</code> objects, regardless of its level. We will use <code>admin_level</code> to filter out boundaries of municipality as a whole and the villages which constitute it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"gmina Prusice"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>prusice <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="at">bbox =</span> b, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>prusice_mun <span class="ot">&lt;-</span> prusice<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(admin_level <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> name <span class="sc">==</span> <span class="st">"gmina Prusice"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:2180"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>willages <span class="ot">&lt;-</span> prusice<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(admin_level <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:2180"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(willages) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_grid</span>(<span class="at">n.x =</span> <span class="dv">5</span>, <span class="at">n.y =</span> <span class="dv">5</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(prusice_mun) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/prusice_all-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Not bad, however there is a lot of villages which surround the municipality. Please remember, the Overpass returns all features which intersects with query bounding box, including whole polygons. To get rid of those villages we will use <code>sf::st_filter()</code> function with <code>st_within</code> predicate to filter out only those villages, which are within municipality boundaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>willages <span class="ot">&lt;-</span> prusice<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(admin_level <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:2180"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(prusice_mun, <span class="at">.predicate=</span>sf<span class="sc">::</span>st_within)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(willages) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_grid</span>(<span class="at">n.x =</span> <span class="dv">5</span>, <span class="at">n.y =</span> <span class="dv">5</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_text</span>(<span class="at">text =</span> <span class="st">"name"</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(prusice_mun) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/prusice_filtered-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OpenStreetMap data it’s not only spatial data base. It contain other information as well. For example, our boundaries of the villages are stored as a relation with ways as members. Additionally there might be <code>admin_center</code> pointing to node (point) which is marked as <code>place = village</code> or <code>town</code> with other tags, like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="st">"Kopaszyn"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"8"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name"</span>, <span class="at">value =</span> <span class="st">"Kopaszyn"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> q <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_xml</span>() </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>a<span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_find_all</span>(<span class="at">xpath =</span> <span class="st">".//node"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_children</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (10)}
 [1] &lt;tag k="name" v="Kopaszyn"/&gt;
 [2] &lt;tag k="old_name:de" v="Kapatschütz"/&gt;
 [3] &lt;tag k="place" v="village"/&gt;
 [4] &lt;tag k="population" v="146"/&gt;
 [5] &lt;tag k="population:date" v="2009"/&gt;
 [6] &lt;tag k="postal_code" v="55-110"/&gt;
 [7] &lt;tag k="source:population" v="GUS"/&gt;
 [8] &lt;tag k="teryt:simc" v="0879794"/&gt;
 [9] &lt;tag k="wikidata" v="Q6431018"/&gt;
[10] &lt;tag k="wikipedia" v="pl:Kopaszyn (województwo dolnośląskie)"/&gt;</code></pre>
</div>
</div>
<p>We can see <code>population</code>, <code>population:date</code> and <code>source:population</code> among others. We can use them and run a simple analysis of population density in our municipality. But please be aware, the data might be a bit obsolete (as <code>population:date</code> indicates), and there might be better source of up-to date data, like national statistical office or Wikipedia/Wikidata.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>prusice_places <span class="ot">&lt;-</span> prusice<span class="sc">$</span>osm_points <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(place <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"village"</span>, <span class="st">"town"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:2180"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>willages <span class="ot">&lt;-</span> willages <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_join</span>(prusice_places) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"name.x"</span>, <span class="st">"population.y"</span>, <span class="st">"geometry"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">population =</span> <span class="fu">as.numeric</span>(population.y), </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">density =</span> population <span class="sc">/</span> <span class="fu">as.numeric</span>(area<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(willages) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"population"</span>, </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.scale =</span> tmap<span class="sc">::</span><span class="fu">tm_scale_continuous</span>(<span class="at">values =</span> <span class="st">"Blues"</span>),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.98</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                                                  <span class="co"># position = c("center", "top"),</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orientation =</span> <span class="st">"landscape"</span>))</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(willages) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"density"</span>, </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.scale =</span> tmap<span class="sc">::</span><span class="fu">tm_scale_continuous</span>(<span class="at">values =</span> <span class="st">"Blues"</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Density per sq. km"</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.98</span>),</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="co"># position = c("center", "top"),</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orientation =</span> <span class="st">"landscape"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-prusice_population" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prusice_population-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-prusice_population" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-prusice_population-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-prusice_population-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-prusice_population-1.png" class="img-fluid figure-img" data-ref-parent="fig-prusice_population" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-prusice_population-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) population
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-prusice_population" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-prusice_population-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-prusice_population-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-prusice_population-2.png" class="img-fluid figure-img" data-ref-parent="fig-prusice_population" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-prusice_population-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) population density
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prusice_population-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.10: Population and population density in Prusice municipality based on OSM data
</figcaption>
</figure>
</div>
<p>A very similar approach can be used for other administrative levels, like municipal arrondissements (subdivisions of the commune) of Paris, France, where boundaries are on <code>admin_level=9</code> (<a href="#fig-paris_france" class="quarto-xref">Figure&nbsp;<span>2.11</span></a>).</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>paris_bbox <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"Paris, France"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(<span class="at">bbox =</span> paris_bbox, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"9"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>paris <span class="ot">&lt;-</span> paris<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">grepl</span>(<span class="st">"Paris"</span>, name))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(paris) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_basemap</span>(<span class="st">"Esri.WorldGrayCanvas"</span>) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-paris_france" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-paris_france-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="osm_files/figure-html/paris_france-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-paris_france-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.11: Arrondissements of Paris
</figcaption>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Overpass query</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="er">out:json</span><span class="ot">][</span><span class="er">timeout:</span><span class="dv">25</span><span class="ot">]</span><span class="er">;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="er">{geocodeArea</span><span class="fu">:</span><span class="st">"Paris, France"</span><span class="fu">}</span><span class="er">};</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">relation</span><span class="ot">[</span><span class="er">admin_level=</span><span class="dv">9</span><span class="ot">]</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="er">boundary=administrative</span><span class="ot">]</span><span class="er">(area);</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="er">out</span> <span class="er">geom;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></section>
<section id="other-kind-of-boundaries" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="other-kind-of-boundaries"><span class="header-section-number">2.2.3</span> Other kind of boundaries</h3>
<p>In addition to administrative boundaries, OpenStreetMap has other types of boundaries. They can be shortlisted using the <code>osmdata::available_tags("boundary")</code> function. But to see the frequency of each tag, you can look at <a href="https://taginfo.openstreetmap.org/keys/boundary#values">taginfo</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">''</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="st">"https://taginfo.openstreetmap.org/api/4/key/values?key=boundary&amp;filter=all&amp;lang=en&amp;sortname=count&amp;sortorder=desc&amp;rp=10&amp;page=1"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(value, count, fraction, description)) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">decimal.mark =</span> <span class="st">"."</span>, <span class="at">big.mark =</span> <span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-other_boundaries" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-other_boundaries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: 10 most popular <code>boundary=</code> values in OpenStreetMap
</figcaption>
<div aria-describedby="tbl-other_boundaries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fraction</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">administrative</td>
<td style="text-align: right;">2011827</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: left;">An administrative boundary recognised by governments for administrative purposes.</td>
</tr>
<tr class="even">
<td style="text-align: left;">protected_area</td>
<td style="text-align: right;">113754</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Used to mark boundaries of protected areas including national parks, wilderness, marine protection areas, heritage sites and other, similar areas.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">postal_code</td>
<td style="text-align: right;">53164</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">A postal code boundary</td>
</tr>
<tr class="even">
<td style="text-align: left;">census</td>
<td style="text-align: right;">24760</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">A census-designated boundary delineating a statistical area, not necessarily observable on the ground</td>
</tr>
<tr class="odd">
<td style="text-align: left;">marker</td>
<td style="text-align: right;">21722</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">A physical marker that identifies a boundary</td>
</tr>
<tr class="even">
<td style="text-align: left;">landuse</td>
<td style="text-align: right;">16364</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">local_authority</td>
<td style="text-align: right;">15884</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">Describes the territory of a local authority</td>
</tr>
<tr class="even">
<td style="text-align: left;">forest_compartment</td>
<td style="text-align: right;">14981</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">A marked subdivision of delimited forest, which is used for planning, management &amp; navigation</td>
</tr>
<tr class="odd">
<td style="text-align: left;">political</td>
<td style="text-align: right;">13918</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">Political boundary, such as an electoral ward or parliamentary constituency</td>
</tr>
<tr class="even">
<td style="text-align: left;">health</td>
<td style="text-align: right;">12756</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<section id="protected-areas" class="level4">
<h4 class="anchored" data-anchor-id="protected-areas">Protected areas</h4>
<p>The second most popular type of borders are the borders of protected areas: national parks, reserves and other areas of cultural importance. They are mapped as <code>boundary = protected_area</code> together with <code>protect_class = 1</code> to <code>99</code>; the first 6 values corresponds to categories introduced by International Union for Conservation of Nature (IUCN) like Strict Nature Reserve (IUCN Category Ia), Wilderness Area (IUCN Category Ib), National Park (IUCN Category II), etc. You can find the details on <a href="https://wiki.openstreetmap.org/wiki/Tag:boundary%3Dprotected_area">wiki</a>. But please be aware there might be another tags combination used to map the boundaries of protected areas like <code>boundary = national_park</code> which corresponds to <code>boundary = protected_area</code> + <code>protect_class = 2</code>. In such case user has to extend the query, therefore in below example we will ask for all boundaries and filter it later using <code>subset()</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>peru <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"Peru"</span>), <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name:en"</span>, <span class="at">value =</span> <span class="st">"Peru"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>peru <span class="ot">&lt;-</span> peru<span class="sc">$</span>osm_multipolygons</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>nat_parks <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(sf<span class="sc">::</span><span class="fu">st_bbox</span>(peru), <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"protect_class"</span>, <span class="at">value =</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>nat_parks <span class="ot">&lt;-</span> nat_parks<span class="sc">$</span>osm_multipolygons <span class="sc">|&gt;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(peru, <span class="at">.predicate=</span>sf<span class="sc">::</span>st_within) <span class="sc">|&gt;</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(boundary <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"national_park"</span>, <span class="st">"protected_area"</span>))</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(nat_parks) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_basemap</span>() <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_credits</span>(<span class="st">"(C) OpenStreetMap contributors"</span>, <span class="at">position =</span>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-national_parks_in_peru" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-national_parks_in_peru-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-national_parks_in_peru-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-national_parks_in_peru-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.12: National parks in Peru
</figcaption>
</figure>
</div>
</div>
</div>
<p>Using a bit of mathematics we can calculate the areas of those parks and arrange them accordingly. In the code below we convert the units from m<sup>2</sup> to km<sup>2</sup> using <code>set_units()</code> function from {units} package <span class="citation" data-cites="units">(<a href="references.html#ref-units" role="doc-biblioref">Pebesma, Mailund, and Hiebert 2016</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nat_parks <span class="ot">&lt;-</span> nat_parks <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>nat_parks<span class="sc">$</span>area <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(nat_parks<span class="sc">$</span>area, km<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 table table-sm table-striped small" data-quarto-postprocess="true">
<caption>National parks in Peru with their area</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">area [km<sup>2</sup>]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Alto Purús</td>
<td style="text-align: right;">25 175</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional del Manu</td>
<td style="text-align: right;">17 054</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Sierra del Divisor</td>
<td style="text-align: right;">13 622</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional Cordillera Azul</td>
<td style="text-align: right;">13 596</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Bahuaja Sonene</td>
<td style="text-align: right;">10 981</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional Yaguas</td>
<td style="text-align: right;">8 720</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Huascarán</td>
<td style="text-align: right;">3 411</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional Otishi</td>
<td style="text-align: right;">3 072</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Río Abiseo</td>
<td style="text-align: right;">2 755</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional Güeppi-Sekime</td>
<td style="text-align: right;">2 049</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Cerros de Amotape</td>
<td style="text-align: right;">1 525</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional Yanachaga-Chemillén</td>
<td style="text-align: right;">1 139</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Ichigkat muja - Cordillera del Cóndor</td>
<td style="text-align: right;">899</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parque Nacional de Cutervo</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parque Nacional Tingo María</td>
<td style="text-align: right;">48</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>Let’s have a look a bit deeper what kind of information is associated with those parks in OSM by displaying all column names:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "osm_id"                 "name"                   "alt_name"              
 [4] "area"                   "boundary"               "boundary_type"         
 [7] "comment"                "description"            "dog"                   
[10] "ethnic_group"           "fixme"                  "governance_type"       
[13] "heritage"               "heritage:operator"      "heritage:website"      
[16] "iba_code"               "is_in:country"          "iucn_level"            
[19] "leisure"                "name:ar"                "name:cb"               
[22] "name:ceb"               "name:de"                "name:en"               
[25] "name:es"                "name:eu"                "name:fr"               
[28] "name:gl"                "name:id"                "name:it"               
[31] "name:ja"                "name:nl"                "name:pt"               
[34] "name:qu"                "name:ru"                "name:sv"               
[37] "name:zh"                "name:zh-Hans"           "norma_creacion"        
[40] "note"                   "official_name"          "old_name"              
[43] "operator"               "operator:short"         "operator:wikidata"     
[46] "ownership"              "protect_class"          "protect_id"            
[49] "protection_object"      "protection_title"       "ramsar"                
[52] "ramsar_no"              "ref:CNUC"               "ref:sernap"            
[55] "ref:whc"                "related_law"            "short_name"            
[58] "short_protection_title" "site_ownership"         "site_status"           
[61] "source"                 "source:date"            "start_date"            
[64] "type"                   "url"                    "website"               
[67] "whc:criteria"           "whc:inscription_date"   "wikidata"              
[70] "wikipedia"              "wikipedia:de"           "wikipedia:es"          
[73] "wikipedia:qu"           "geometry"              </code></pre>
</div>
</div>
<p>Let’s take the <strong>Parque Nacional Alto Purús</strong> as an example and display some of those fields.</p>
<div class="cell tbl-column-body-outset-right">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nat_parks <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(name <span class="sc">==</span> <span class="st">"Parque Nacional Alto Purús"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"short_name"</span>, <span class="st">"operator"</span>, <span class="st">"related_law"</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"start_date"</span>, <span class="st">"wikipedia"</span>, <span class="st">"wikidata"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>(<span class="at">row.names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-park_details" class="cell tbl-column-body-outset-right quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-park_details-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.3: Some details about Parque Nacional Alto Purús from OpenStreetMap data
</figcaption>
<div aria-describedby="tbl-park_details-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell tbl-column-body-outset-right table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">short_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">operator</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">related_law</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">start_date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wikipedia</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">wikidata</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alto Purús</td>
<td style="text-align: left;">SERNANP</td>
<td style="text-align: left;">D.S. N° 040-2004_AG.</td>
<td style="text-align: left;">2004-11-18</td>
<td style="text-align: left;">es:Parque nacional del Alto Purús</td>
<td style="text-align: left;">Q2812162</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>With <code>wikipedia</code> field we can create link to Wikipedia article but let’s have a look on <code>wikidata</code> – it host <a href="https://www.wikidata.org/">Wikidata</a> entry for our national park. Using {wikidataR} package <span class="citation" data-cites="WikidataR">(<a href="references.html#ref-WikidataR" role="doc-biblioref">Shafee, Keyes, and Signorelli 2021</a>)</span> we can explore the information stored there. In first step we have to get information behind the item coded as <code>Q2812162</code>. Then we extract the image property (<code>P18</code>) for this item. In next step we build an URL to Wikimedia Commons to grab image, it’s attributes and display it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> WikidataR<span class="sc">::</span><span class="fu">get_item</span>(<span class="st">"Q2812162"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> WikidataR<span class="sc">::</span><span class="fu">extract_claims</span>(w, <span class="st">"P18"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>wiki_image <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]<span class="sc">$</span>P18.x<span class="sc">$</span>mainsnak<span class="sc">$</span>datavalue<span class="sc">$</span>value <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://commons.wikimedia.org/wiki/File:"</span>, wiki_image)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_html</span>(url)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>image <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">"/html/body/div[3]/div[3]/div[5]/div[1]/div/span"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_child</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>licence <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">"/html/body/div[3]/div[3]/div[5]/div[3]/div/div[2]/div/div[1]/div[2]/div/div[2]/div[2]/div[2]/div[1]"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_children</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_text</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="at">sep =</span> <span class="st">" "</span>, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>licence_link <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">"/html/body/div[3]/div[3]/div[5]/div[3]/div/div[2]/div/div[1]/div[2]/div/div[2]/div[2]/div[2]/div[1]/a[2]"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>attribution <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">"/html/body/div[3]/div[3]/div[5]/div[3]/div/div[2]/div/div[1]/div[2]/div/div[2]/div[2]/div[2]/div[2]/span"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  xml2<span class="sc">::</span><span class="fu">xml_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Pur%C3%BAs_peruano_1.png/320px-Pur%C3%BAs_peruano_1.png" class="img-fluid figure-img"></p>
<figcaption>Image by FUERZA AÉREA DEL PERÚ, licence: <a href="https://creativecommons.org/licenses/by/3.0/deed.en">Creative Commons Attribution 3.0 Unported</a></figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have you realized how easy is to combine data from 2 sources: OpenStreetMap and Wikipedia?</p>
</div>
</div>
</section>
<section id="sec-postal_code" class="level4">
<h4 class="anchored" data-anchor-id="sec-postal_code">Postal code areas</h4>
<p>Postal code boundaries are the third most common boundaries in OSM, however please be aware, that such information doesn’t exist in each country. <a href="#fig-postal_code_distribution_map" class="quarto-xref">Figure&nbsp;<span>2.13</span></a> displays the distribution of this tag — mostly used in Belgium, Germany, Vietnam and in few other spots across the globe.</p>
<div id="fig-postal_code_distribution_map" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-postal_code_distribution_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/postal_codes_distribution.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-postal_code_distribution_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.13: Postal code boundaries distribution, source: <a href="https://taginfo.openstreetmap.org/tags/boundary=postal_code#map">taginfo</a>
</figcaption>
</figure>
</div>
<p>As an example we will use {osmextract} to deal with data. Let say, we are interested in data set around Leipzig, Germany. First, we can check if any data provider offers such set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_match</span>(<span class="at">place =</span> <span class="fu">c</span>(<span class="st">"Leipzig"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No exact match found for place = Leipzig and provider = geofabrik. Best match is Belize. 
Checking the other providers.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>An exact string match was found using provider = bbbike.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$url
[1] "https://download.bbbike.org/osm/bbbike/Leipzig/Leipzig.osm.pbf"

$file_size
[1] 41934061</code></pre>
</div>
</div>
<p>We can download and preprocess it using <code>oe_get()</code> function. In this step the file is downloaded and all closed linestrings or relations are converted to layer with geometry type MULTIPOLYGON and stored in corresponding <code>.gpkg</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> osmextract<span class="sc">::</span><span class="fu">oe_get</span>(<span class="st">"Leipzig"</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">"multipolygons"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">download_directory =</span> <span class="st">"data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As the layer contains 574267 different features (including land usage, buildings, parks, forests etc.) and it takes 703 Mb, it not necessary make sense to load it in whole. As we are interested in postal area boundaries, let utilize <code>query=</code> parameter and <code>hstore_get_value()</code> function.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> osmextract<span class="sc">::</span><span class="fu">oe_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">query =</span> <span class="st">"SELECT osm_id, </span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="st">                   hstore_get_value(other_tags, 'postal_code') AS p_code,</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="st">                   hstore_get_value(other_tags, 'postal_code_level') AS p_level,</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="st">                   geometry </span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="st">                FROM multipolygons WHERE boundary = 'postal_code'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 71 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 12.02171 ymin: 50.98035 xmax: 12.89833 ymax: 51.5876
Geodetic CRS:  WGS 84
First 10 features:
    osm_id p_code p_level                       geometry
1  1263641  04610       8 MULTIPOLYGON (((12.35531 51...
2  1263646  04617       8 MULTIPOLYGON (((12.50344 51...
3  1263648  04613       8 MULTIPOLYGON (((12.27817 51...
4  1300367  04643       8 MULTIPOLYGON (((12.62641 51...
5  1300368  04821       8 MULTIPOLYGON (((12.58278 51...
6  1300369  04552       8 MULTIPOLYGON (((12.44659 51...
7  1300371  04451       8 MULTIPOLYGON (((12.56898 51...
8  1300374  04539       8 MULTIPOLYGON (((12.3752 51....
9  1300375  04571       8 MULTIPOLYGON (((12.45343 51...
10 1300376  04687       8 MULTIPOLYGON (((12.67303 51...</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> l <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">post_prefix =</span> <span class="fu">substr</span>(p_code, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(l) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"post_prefix"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.scale =</span> tmap<span class="sc">::</span><span class="fu">tm_scale_categorical</span>(<span class="at">values =</span> <span class="st">"Blues"</span>),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Postal prefix"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-oe_leipzig_addresses" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oe_leipzig_addresses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-oe_leipzig_addresses-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oe_leipzig_addresses-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.14: Postal prefixes in and around Lepizig
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>As stated previously, the post code areas are sparse and scattered. As an idea: we can collect the post code from <code>addr:postcode</code> tag assigned to places (osm_points or osm_(multi)polygons) and/or buildings/addresses then map it to lowest level of administrative boundary, however this may work for villages or small settlements. But assumption that postal areas corresponds somehow to administrative boundaries might be wrong. In bigger towns the post code may change from block to block. Other idea: having the addresses as POINT features one may try <a href="https://rpubs.com/Dr_Gurpreet/spatial_interpolation_kriging_R">spatial kriging</a> on them. Other method might be to use voronoi polygons.</p>
</div>
</div>
<p>Below an approach to add the postal codes to village boundaries using Wikidata as source.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>adm_b <span class="ot">&lt;-</span> osmextract<span class="sc">::</span><span class="fu">oe_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> <span class="st">"SELECT osm_id, boundary, admin_level, name, </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="st">                  hstore_get_value(other_tags, 'postal_code') AS p_code, </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="st">                  hstore_get_value(other_tags, 'wikidata') AS wikidata,</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="st">                  geometry</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="st">              FROM multipolygons</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="st">              WHERE boundary = 'administrative'"</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>adm_b <span class="ot">&lt;-</span> adm_b <span class="sc">|&gt;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(admin_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(p_code))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function which grabs the data is based on {WikidataR} package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>get_postal_code_from_wikidata <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">q =</span> <span class="st">""</span>) {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (q <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(q)) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">&lt;-</span> WikidataR<span class="sc">::</span><span class="fu">get_item</span>(q)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> WikidataR<span class="sc">::</span><span class="fu">extract_claims</span>(w, <span class="st">"P281"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(x[[<span class="dv">1</span>]]<span class="sc">$</span>P281.x) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> x[[<span class="dv">1</span>]]<span class="sc">$</span>P281.x<span class="sc">$</span>mainsnak<span class="sc">$</span>datavalue<span class="sc">$</span>value</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(a <span class="sc">&gt;</span> <span class="dv">1</span>)) {</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        a <span class="ot">&lt;-</span> a <span class="sc">|&gt;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="at">str =</span> <span class="st">","</span>, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(stringr<span class="sc">::</span><span class="fu">str_replace</span>(a, <span class="st">",$"</span>, <span class="st">""</span>))</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>adm_b <span class="ot">&lt;-</span> adm_b <span class="sc">|&gt;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">postal_code =</span> <span class="fu">get_postal_code_from_wikidata</span>(wikidata))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-with_postal_codes" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-with_postal_codes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.4: Example of administrative areas with postal code assigned
</figcaption>
<div aria-describedby="tbl-with_postal_codes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">admin_level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">postal_code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Markkleeberg</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04416</td>
</tr>
<tr class="even">
<td style="text-align: left;">Großpösna</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04463</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Seelitz</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">09306</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rochlitz</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">09306</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Königsfeld</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">09306</td>
</tr>
<tr class="even">
<td style="text-align: left;">Zettlitz</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">09306</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Markranstädt</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04420</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kitzen</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">04523</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pegau</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04523</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elstertrebnitz</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04523</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Groitzsch</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04539</td>
</tr>
<tr class="even">
<td style="text-align: left;">Regis-Breitingen</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">04565</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-administrative_areas_by_code_prefixes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-administrative_areas_by_code_prefixes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-administrative_areas_by_code_prefixes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-administrative_areas_by_code_prefixes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.15: Administrative areas with postal codes from Wikidata, grouped by prefix
</figcaption>
</figure>
</div>
</div>
</div>
<!--
#TODO https://gis.stackexchange.com/questions/2682/seeking-sources-for-us-zip-code-boundaries
-->
</section>
</section>
</section>
<section id="sec-land_coverage" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-land_coverage"><span class="header-section-number">2.3</span> Land coverage and use</h2>
<p>Land coverage (representation of physical surface on the Earth like grass, asphalt, trees, ground, water) and land use (how humans modified and managed the natural environment into arable fields, pastures or settlements) is another area where you can use OpenStreetMap data. In mid of 2010’s Jacinto Estima and Marco Painho investigated the coverage of OSM data in Portugal <span class="citation" data-cites="estimaExploratoryAnalysisOpenStreetMap2013 estimaInvestigatingPotentialOpenstreetmap2015">(<a href="references.html#ref-estimaExploratoryAnalysisOpenStreetMap2013" role="doc-biblioref">Estima and Painho 2013</a>, <a href="references.html#ref-estimaInvestigatingPotentialOpenstreetmap2015" role="doc-biblioref">2015</a>)</span>, followed later by others <span class="citation" data-cites="schultzOpenLandCover2017a schottOpenstreetmapElementVectorisation2022a">(<a href="references.html#ref-schultzOpenLandCover2017a" role="doc-biblioref">Schultz et al. 2017</a>; <a href="references.html#ref-schottOpenstreetmapElementVectorisation2022a" role="doc-biblioref">Schott et al. 2022</a>)</span>. Based on those works there is even an <a href="https://osmlanduse.org/">osmlanduse.org</a> service build and hosted by Heidelberg Institute for Geoinformation Technology. Recently the topic was discussed by <span class="citation" data-cites="fonteUsingOpenStreetMapCreate2019">Fonte et al. (<a href="references.html#ref-fonteUsingOpenStreetMapCreate2019" role="doc-biblioref">2019</a>)</span> where they compared OSM data with two European LULC products: the Urban Atlas and CORINE Land Cover.</p>
<p>The main keys which describes those features are <code>natural</code> and <code>landuse</code>. <a href="#tbl-corine-to-osm" class="quarto-xref">Table&nbsp;<span>2.5</span></a> shows the mapping between Corine Land Cover database and OSM data. Corine data was used in the past to map the surface of Europe, nowadays the data is replaced by other sources, mainly ortophoto maps, however the table gives a good overview of tag-value combinations for area mapping.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> rvest<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">"https://wiki.openstreetmap.org/wiki/Corine_Land_Cover"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_table</span>()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>tables[[<span class="dv">1</span>]] <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(Code, Description, Comment)) <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Comment =</span> stringi<span class="sc">::</span><span class="fu">stri_replace_all_regex</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      Comment, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">"([a-z]+)=([a-z]+)"</span>, </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"\`$1=$2\`"</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>() <span class="sc">|&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-corine-to-osm" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-corine-to-osm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.5: Corine Land Cover classess and corresponding OpenStreetMap taging system. Source: <a href="https://wiki.openstreetmap.org/wiki/Corine_Land_Cover">wiki</a>.
</figcaption>
<div aria-describedby="tbl-corine-to-osm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Artificial surfaces</td>
<td style="text-align: left;">Artificial surfaces</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">Urban fabric</td>
<td style="text-align: left;">Urban fabric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.1.1</td>
<td style="text-align: left;">Continuous urban fabric</td>
<td style="text-align: left;">`landuse=residential`, `landuse=commercial`, `landuse=retail` and `landuse=industrial`</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.1.2</td>
<td style="text-align: left;">Discontinuous urban fabric</td>
<td style="text-align: left;">`landuse=residential`, `landuse=commercial`, `landuse=retail` and `landuse=industrial`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.2</td>
<td style="text-align: left;">Industrial, commercial and transport units</td>
<td style="text-align: left;">Industrial, commercial and transport units</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.2.1</td>
<td style="text-align: left;">Industrial or commercial units</td>
<td style="text-align: left;">`landuse=industrial`, `landuse=commercial`, or `landuse=retail`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.2.2</td>
<td style="text-align: left;">Road and rail networks and associated land</td>
<td style="text-align: left;">`landuse=railway` for railway areas only. This class is a mix of road and rail landuse; `landuse=highway` is not commonly used.</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.2.3</td>
<td style="text-align: left;">Port areas</td>
<td style="text-align: left;">`landuse=industrial` + `industrial=port` or `leisure=marina`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.2.4</td>
<td style="text-align: left;">Airports</td>
<td style="text-align: left;">`aeroway=aerodrome`</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.3</td>
<td style="text-align: left;">Mine, dump and construction sites</td>
<td style="text-align: left;">Mine, dump and construction sites</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.3.1</td>
<td style="text-align: left;">Mineral extraction sites</td>
<td style="text-align: left;">`landuse=quarry`</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.3.2</td>
<td style="text-align: left;">Dump sites</td>
<td style="text-align: left;">`landuse=landfill`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.3.3</td>
<td style="text-align: left;">Construction sites</td>
<td style="text-align: left;">`landuse=construction`</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.4</td>
<td style="text-align: left;">Artificial, non-agricultural vegetated areas</td>
<td style="text-align: left;">Artificial, non-agricultural vegetated areas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.4.1</td>
<td style="text-align: left;">Green urban areas</td>
<td style="text-align: left;">Several tags are possible: `leisure=park`, `leisure=garden`, `leisure=pitch`, `leisure=golf`_course,`landuse=grass`, `natural=wood`, and other tags</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.4.2</td>
<td style="text-align: left;">Sport and leisure facilities</td>
<td style="text-align: left;">See leisure=* for the many possibilities.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Agricultural areas</td>
<td style="text-align: left;">Agricultural areas</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.1</td>
<td style="text-align: left;">Arable land</td>
<td style="text-align: left;">Arable land</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.1.1</td>
<td style="text-align: left;">Non-irrigated arable land</td>
<td style="text-align: left;">`landuse=farmland`</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.1.2</td>
<td style="text-align: left;">Permanently irrigated land</td>
<td style="text-align: left;">`landuse=farmland`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.1.3</td>
<td style="text-align: left;">Rice fields</td>
<td style="text-align: left;">`landuse=farmland` + `crop=rice`</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2</td>
<td style="text-align: left;">Permanent crops</td>
<td style="text-align: left;">Permanent crops</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.2.1</td>
<td style="text-align: left;">Vineyards</td>
<td style="text-align: left;">`landuse=vineyard`</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2.2</td>
<td style="text-align: left;">Fruit trees and berry plantations</td>
<td style="text-align: left;">`landuse=orchard`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.2.3</td>
<td style="text-align: left;">Olive groves</td>
<td style="text-align: left;">`landuse=orchard` + `trees=olive`_trees</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.3</td>
<td style="text-align: left;">Pastures</td>
<td style="text-align: left;">Pastures</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.3.1</td>
<td style="text-align: left;">Pastures</td>
<td style="text-align: left;">`landuse=meadow`</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.4</td>
<td style="text-align: left;">Heterogeneous agricultural areas</td>
<td style="text-align: left;">Heterogeneous agricultural areas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.4.1</td>
<td style="text-align: left;">Annual crops associated with permanent crops</td>
<td style="text-align: left;">Usually but not always `landuse=farmland`</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.4.2</td>
<td style="text-align: left;">Complex cultivation patterns</td>
<td style="text-align: left;">No single tag, consider `landuse=farmland`, `landuse=meadow`, `landuse=orchard` and `landuse=farmyard` for specific areas.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.4.3</td>
<td style="text-align: left;">Land principally occupied by agriculture, with significant areas of natural vegetation</td>
<td style="text-align: left;">No single tag, consider `landuse=farmland`, `landuse=meadow`, `landuse=orchard` and `landuse=farmyard` for specific agricultural areas, plus `natural=wood`, `natural=scrub`, etc. for natural areas.</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.4.4</td>
<td style="text-align: left;">Agro-forestry areas</td>
<td style="text-align: left;">`landuse=forest`, `landuse=meadow`, `landuse=farmland` or a combination - requires survey.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Forest and seminatural areas</td>
<td style="text-align: left;">Forest and seminatural areas</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.1</td>
<td style="text-align: left;">Forests</td>
<td style="text-align: left;">Forests</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.1.1</td>
<td style="text-align: left;">Broad-leaved forest</td>
<td style="text-align: left;">`landuse=forest` or `natural=wood` + leaf_`type=broadleaved`</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.1.2</td>
<td style="text-align: left;">Coniferous forest</td>
<td style="text-align: left;">`landuse=forest` or `natural=wood` + leaf_`type=needleleaved`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.1.3</td>
<td style="text-align: left;">Mixed forest</td>
<td style="text-align: left;">`landuse=forest` or `natural=wood` + leaf_`type=mixed`</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.2</td>
<td style="text-align: left;">Scrub and/or herbaceous vegetation associations</td>
<td style="text-align: left;">Scrub and/or herbaceous vegetation associations</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.2.1</td>
<td style="text-align: left;">Natural grasslands</td>
<td style="text-align: left;">`natural=grassland`</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.2.2</td>
<td style="text-align: left;">Moors and heathland</td>
<td style="text-align: left;">`natural=heath`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.2.3</td>
<td style="text-align: left;">Sclerophyllous vegetation</td>
<td style="text-align: left;">`natural=scrub`</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.2.4</td>
<td style="text-align: left;">Transitional woodland-shrub</td>
<td style="text-align: left;">`natural=wood` or `natural=scrub` + leaf_`type=mixed`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.3</td>
<td style="text-align: left;">Open spaces with little or no vegetation</td>
<td style="text-align: left;">Open spaces with little or no vegetation</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.3.1</td>
<td style="text-align: left;">Beaches, dunes, sands</td>
<td style="text-align: left;">`natural=beach` or `natural=sand`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.3.2</td>
<td style="text-align: left;">Bare rocks</td>
<td style="text-align: left;">`natural=rock`, `natural=scree` or `natural=shingle`</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.3.3</td>
<td style="text-align: left;">Sparsely vegetated areas</td>
<td style="text-align: left;">Depending on main features, see `natural=scrub`, `natural=heath`, `natural=grassland`, `natural=bare`_rock, `natural=sand`, `natural=scree`, etc.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.3.4</td>
<td style="text-align: left;">Burnt areas</td>
<td style="text-align: left;">N/A - not permanent.</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.3.5</td>
<td style="text-align: left;">Glaciers and perpetual snow</td>
<td style="text-align: left;">`natural=glacier`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Wetlands</td>
<td style="text-align: left;">Wetlands</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">Inland wetlands</td>
<td style="text-align: left;">Inland wetlands</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4.1.1</td>
<td style="text-align: left;">Inland marshes</td>
<td style="text-align: left;">`natural=wetland` + `wetland=marsh`</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.1.2</td>
<td style="text-align: left;">Peat bogs</td>
<td style="text-align: left;">`natural=wetland` + `wetland=bog`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4.2</td>
<td style="text-align: left;">Maritime wetlands</td>
<td style="text-align: left;">Maritime wetlands</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.2.1</td>
<td style="text-align: left;">Salt marshes</td>
<td style="text-align: left;">`natural=wetland` + `wetland=saltmarsh`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4.2.2</td>
<td style="text-align: left;">Salines</td>
<td style="text-align: left;">`landuse=salt`_pond (See Proposed features/Salt Pond )</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.2.3</td>
<td style="text-align: left;">Intertidal flats</td>
<td style="text-align: left;">`wetland=tidalflat` or `tidal=yes` (See Proposed_features/Water_cover)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Water bodies</td>
<td style="text-align: left;">Water bodies</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.1</td>
<td style="text-align: left;">Inland waters</td>
<td style="text-align: left;">Inland waters</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5.1.1</td>
<td style="text-align: left;">Water courses</td>
<td style="text-align: left;">`waterway=riverbank`</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.1.2</td>
<td style="text-align: left;">Water bodies</td>
<td style="text-align: left;">`natural=water` + `water=lake`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5.2</td>
<td style="text-align: left;">Marine waters</td>
<td style="text-align: left;">Marine waters</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.2.1</td>
<td style="text-align: left;">Coastal lagoons</td>
<td style="text-align: left;">`natural=water` + `water=lagoon` - also see `natural=coastline`</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5.2.2</td>
<td style="text-align: left;">Estuaries</td>
<td style="text-align: left;">No compatible tag found</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.2.3</td>
<td style="text-align: left;">Sea and ocean</td>
<td style="text-align: left;">See `natural=coastline`</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s use already downloaded data set for Leipzig and see, what is there for land use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>, <span class="at">query =</span> <span class="st">"SELECT DISTINCT natural</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="st">            FROM multipolygons WHERE natural != '' ORDER BY natural"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading query `SELECT DISTINCT natural
            FROM multipolygons WHERE natural != '' ORDER BY natural'
from data source `/home/sapi/projekty/open_data/data/bbbike_Leipzig.gpkg' using driver `GPKG'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$natural
 [1] "bare_rock"  "basin"      "beach"      "bedrock"    "cliff"     
 [6] "floodplain" "grass"      "grassland"  "heath"      "mud"       
[11] "pond"       "reef"       "ridge"      "rock"       "sand"      
[16] "scree"      "scrub"      "shingle"    "shrubbery"  "stone"     
[21] "tree_row"   "water"      "wetland"    "wood"       "yes"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>, <span class="at">query =</span> <span class="st">"SELECT DISTINCT landuse</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="st">            FROM multipolygons WHERE landuse != '' ORDER BY landuse"</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading query `SELECT DISTINCT landuse
            FROM multipolygons WHERE landuse != '' ORDER BY landuse'
from data source `/home/sapi/projekty/open_data/data/bbbike_Leipzig.gpkg' using driver `GPKG'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$landuse
 [1] "allotments"              "animal_keeping"         
 [3] "apiary"                  "aquaculture"            
 [5] "basin"                   "brownfield"             
 [7] "cemetery"                "churchyard"             
 [9] "city_green"              "civic_admin"            
[11] "commercial"              "concrete"               
[13] "construction"            "depot"                  
[15] "education"               "emergency"              
[17] "farmland"                "farmyard"               
[19] "flowerbed"               "forest"                 
[21] "garages"                 "garden"                 
[23] "grass"                   "greenfield"             
[25] "greenhouse_horticulture" "greenland"              
[27] "highway"                 "industrial"             
[29] "institutional"           "landfill"               
[31] "meadow"                  "military"               
[33] "orchard"                 "plant_nursery"          
[35] "playground"              "proposed"               
[37] "quarry"                  "railway"                
[39] "recreation_ground"       "religious"              
[41] "reservoir"               "residential"            
[43] "retail"                  "road"                   
[45] "storage"                 "street_green"           
[47] "village_green"           "vineyard"               </code></pre>
</div>
</div>
<p>You may observe that a forest can be described as either <code>natural = wood</code> or <code>landuse = forest</code> so, it’s necessary to combine those pairs. Similarly, various classes of of industrial areas, such as <code>industrial</code>, <code>commercial</code>, <code>construction</code> etc., can be aggregated. It’s important to note that there might be instances <code>boundary = forest_compartment</code> (refer to <a href="#tbl-other_boundaries" class="quarto-xref">Table&nbsp;<span>2.2</span></a>), which should be examined and potentially included as well. The code chunk below is just one example of numerous possible ways to extract the information. Please note <code>query =</code> parameter, which queries the database <a href="https://gdal.org/user/ogr__dialect.html">in OGR dialect</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>lu <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">query =</span> <span class="st">"SELECT osm_id, name, landuse, natural, 'forest' AS type, geometry \</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="st">                     FROM multipolygons \</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="st">                     WHERE landuse = 'forest' OR natural = 'wood' \</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="st">                   UNION \</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="st">                   SELECT osm_id, name, landuse, natural, 'residential' AS type, geometry \</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="st">                     FROM multipolygons \</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="st">                     WHERE landuse IN ('residential', 'education', 'religious') \</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="st">                   UNION \</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="st">                   SELECT osm_id, name, landuse, natural, 'commercial' AS type, geometry \</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="st">                     FROM multipolygons \</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="st">                     WHERE landuse IN ('industrial', 'commercial', 'construction')"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">|&gt;</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:25832"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(type) <span class="sc">|&gt;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-leipzig_land_use" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-leipzig_land_use-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-leipzig_land_use-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-leipzig_land_use-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.16: Example of land use around Leipzig, Germany
</figcaption>
</figure>
</div>
</div>
</div>
<p>A freely accessible global land cover product at 10 m resolution, based on Sentinel-1 and Sentinel-2 data, containing 11 land cover classes, is available online at <a href="https://esa-worldcover.org">https://esa-worldcover.org</a>. More information in <a href="environments.html#sec-esa_worldcover" class="quarto-xref"><span>Section 3.1.1</span></a>.</p>
</section>
<section id="where-the-streets-have-no-names" class="level2 page-columns page-full" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="where-the-streets-have-no-names"><span class="header-section-number">2.4</span> Where the streets have no names</h2>
<p>Streets, roads or paths — all have <code>highway</code> key within OSM. The main road types, their values and meaning is shown in <a href="#tbl-osm_highways" class="quarto-xref">Table&nbsp;<span>2.6</span></a>. Except those highways, there is a bunch of others like <code>living_street</code> <code>pedestrian</code> or just a <code>track</code> in forest — details are available on <a href="https://wiki.openstreetmap.org/wiki/Key:highway">wiki</a>. The OSM roads network data is probably most used data around the world. It’s a base for different navigation systems (including OSMAnd), for visualization of bus routes, it is also used in online games.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/GzZWSrr5wFI" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div></div><div class="cell">
<div id="tbl-osm_highways" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-osm_highways-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.6: Roads and their coding values in OpenStreetMap data. Source: <a href="https://wiki.openstreetmap.org/wiki/Key:highway">wiki</a>
</figcaption>
<div aria-describedby="tbl-osm_highways-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">motorway</td>
<td style="text-align: left;">A restricted access major divided highway, normally with 2 or more running lanes plus emergency hard shoulder. Equivalent to the Freeway, Autobahn, etc..</td>
</tr>
<tr class="even">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">trunk</td>
<td style="text-align: left;">The most important roads in a country's system that aren't motorways. (Need not necessarily be a divided highway.)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">primary</td>
<td style="text-align: left;">The next most important roads in a country's system. (Often link larger towns.)</td>
</tr>
<tr class="even">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">secondary</td>
<td style="text-align: left;">The next most important roads in a country's system. (Often link towns.)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">tertiary</td>
<td style="text-align: left;">The next most important roads in a country's system. (Often link smaller towns and villages)</td>
</tr>
<tr class="even">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">unclassified</td>
<td style="text-align: left;">The least important through roads in a country's system – i.e. minor roads of a lower classification than tertiary, but which serve a purpose other than access to properties. (Often link villages and hamlets.) The word 'unclassified' is a historical artefact of the UK road system and does not mean that the classification is unknown; you can use highway=road for that.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highway</td>
<td style="text-align: left;">residential</td>
<td style="text-align: left;">Roads which serve as an access to housing, without function of connecting settlements. Often lined with housing.</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s extend Prusice municipality data with highways and see, what’s available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>prusice_highways <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(b, <span class="at">timeout =</span> <span class="dv">60</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"highway"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>highways <span class="ot">&lt;-</span> prusice_highways<span class="sc">$</span>osm_lines <span class="sc">|&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(highway)) <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:2180"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(prusice_mun)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(highways<span class="sc">$</span>highway)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "unclassified"  "residential"   "track"         "tertiary"     
 [5] "service"       "secondary"     "living_street" "footway"      
 [9] "trunk"         "pedestrian"    "path"          "cycleway"     
[13] "trunk_link"    "steps"         "proposed"     </code></pre>
</div>
</div>
<p>Comparing with <a href="#tbl-osm_highways" class="quarto-xref">Table&nbsp;<span>2.6</span></a> we can see <code>trunk</code> and <code>trunk_link</code> as the main road categories, followed by <code>secondary</code>, <code>tertiary</code>, etc. Let’s add them to our map.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> highways <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"trunk"</span>, <span class="st">"trunk_link"</span>, <span class="st">"secondary"</span>, <span class="st">"tertiary"</span>, <span class="st">"residential"</span>, <span class="st">"track"</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>linewidths <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">highway =</span> <span class="fu">c</span>(<span class="st">"trunk"</span>, <span class="st">"trunk_link"</span>, <span class="st">"secondary"</span>, <span class="st">"tertiary"</span>, <span class="st">"residential"</span>, <span class="st">"track"</span>),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">1.8</span>, <span class="fl">1.6</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> h <span class="sc">|&gt;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(linewidths, <span class="at">by =</span> <span class="st">"highway"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>tm <span class="ot">&lt;-</span> tmap<span class="sc">::</span><span class="fu">tm_shape</span>(prusice_mun) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(h) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"highway"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="st">"lwd"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">bg.color =</span> <span class="st">"white"</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">show =</span> <span class="cn">FALSE</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>tm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-prusice_highways" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prusice_highways-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-prusice_highways-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prusice_highways-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.17: Different roads classes in Prusice municipality based on OSM data
</figcaption>
</figure>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>For those who prefer to use QGIS for styling and maps production, there is couple of resources to start with, including Anita’s Graser blog posts <span class="citation" data-cites="underdarkGuideAdvancedLabeling2011 underdarkGoogleMapsStyle2011 underdarkGuideGoogleMapslikeMaps2014">(<a href="references.html#ref-underdarkGuideAdvancedLabeling2011" role="doc-biblioref">underdark 2011a</a>, <a href="references.html#ref-underdarkGoogleMapsStyle2011" role="doc-biblioref">2011b</a>, <a href="references.html#ref-underdarkGuideGoogleMapslikeMaps2014" role="doc-biblioref">2014</a>)</span>. Look around and you will find <a href="https://gitlab.com/champs-libres/public/champs-libres-qgis-osm-style">nice examples</a>.</p>
</div></div><p>You can use other tags associated with highways to check if it goes over bridge (<code>bridge = yes</code> or <code>viaduct</code>) or in tunnel (<code>tunell = yes</code>), what’s the max allowed speeds (various tags starting with <code>maxspeed</code>), what’s the road number (<code>ref</code> tag) or <code>name</code>, what’s the <code>surface</code> or <code>smoothness</code>, etc.</p>
<section id="bike-infrastructure" class="level3 page-columns page-full" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="bike-infrastructure"><span class="header-section-number">2.4.1</span> Bike infrastructure</h3>
<p>In OpenStreetMap database the roads designated for bicycle can be described in different ways. The lanes can be separate, can be part of highway, or shared with pedestrians (and in some countries even with other vehicles). Let’s have a quick overview of the used tags.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is non exhaustive list of all possible tags which can be used. For more information see wiki description of <a href="https://wiki.openstreetmap.org/wiki/Key:cycleway">cycleway</a> and <a href="https://wiki.openstreetmap.org/wiki/Bicycle">bicycle infrastructure</a>.</p>
</div>
</div>
<p>Separated ways for cycling usually are described as <code>highway = cycleway</code>, and in the field they are marked with white bicycle on blue background sign.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<pre><code>highway = cycleway</code></pre>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/3/30/PL_road_sign_C-13.svg" class="img-fluid" width="50"></p>
</div></div><p>If the cycling lane is shared with pedestrians, the usual tagging is:</p>
<pre><code>highway = footway | path
bicycle = designated
foot = designated</code></pre>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/e/ee/PL_road_sign_C-13-16.svg" class="img-fluid" width="50">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="https://upload.wikimedia.org/wikipedia/commons/2/2e/PL_road_sign_C-13-16a.svg" class="img-fluid" width="50"></p>
</div></div><p>Another possibility is to share the lane with cars on any highway (primary, tertiary, residential, etc). It can be the lane in the same or opposite direction. Tagging</p>
<pre><code>highway = *
cycleway = lane</code></pre>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/1/13/PL_road_sign_F-19.svg" height="50"></p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/c/c8/Znak_B-2+T-22.png" height="50"> <img src="https://upload.wikimedia.org/wikipedia/commons/e/e2/Znak_D-3+T-22.png" height="50"></p>
</div></div><p>is used to tag two-way streets where there are cycle lanes on both sides of the road, or one-way streets where the lane operating in the same direction as main traffic flow. <code>cycleway = opposite_lane</code> is used for contraflow; <code>cycleway = opposite</code> + <code>oneway:bicycle = no</code> where cyclist are permitted to travel in both direction on one-way street. For shared lanes with motor vehicles: <code>cycleway = shared_lane</code> and <code>cycleway=share_busway</code> with buses. For more specific tagging please check <a href="https://wiki.openstreetmap.org/wiki/Key:cycleway">wiki page</a>.</p>
<p>In some countries additional tagging is in use. <code>highway = *</code> + <code>bicycle_road = yes</code> for signed roads and <code>cyclestreet = yes</code> for roads where other vehicles are allowed.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Zeichen_244.3_-_Beginn_einer_Fahrradzone,_StVO_2020.svg" class="img-fluid" width="50"></p>
</div></div><section id="other-features" class="level4">
<h4 class="anchored" data-anchor-id="other-features">Other features</h4>
<p>Bicycle shops are tagged with <code>shop = bicycle</code>, and those which provide additional repair services have <code>service:bicycle:repair = yes</code> tags. There might be a do-it-yourself service stations, equipped with pump, wrenches and other helpful tools — in such case they are tagged with <code>amenity = bicycle_repair_station</code>.</p>
<p>Bicycle parkings are tagged with <code>amenity = bicycle_parking</code>. In towns where you can rent a bike, you will find <code>amenity = bicycle_rental</code> tags.</p>
</section>
<section id="bicycle-routes" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="bicycle-routes">Bicycle routes</h4>
<blockquote class="blockquote">
<p>Cycle routes or bicycle route are named or numbered or otherwise signed routes. May go along roads, trails or dedicated cycle paths.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
</blockquote>
<p>They are tagged as a relations (several features grouped together with relation roles assigned)<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>; they can be of different network levels: <code>network = icn | ncn | rcn | lcn</code> which corresponds to international route, a national, a regional or a local route. Below an example of tagging of part of EuroVelo 9 route:</p>
<pre><code>type = route
route = bicycle
network = icn
ref = EV9
colour = green
icn_ref = 9</code></pre>
<p>As we already know and understand the attributes of the data, let’s play with it a bit. In next steps we will assess quantitatively the bicycle infrastructure in Leipzig, based on the data we already downloaded in <a href="#sec-postal_code" class="quarto-xref"><span>Section 2.2.3.2</span></a>.</p>
<p>First step would be to extract points, lines and polygons related bo bike infrastructure and convert it to <code>.gpkg</code> file using <code>osmextract::oe_vectortranslate()</code> function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_vectortranslate</span>(<span class="st">"data/bbbike_Leipzig.osm.pbf"</span>, <span class="at">layer =</span> <span class="st">"points"</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">extra_tags =</span> <span class="fu">c</span>(<span class="st">"shop"</span>, <span class="st">"amenity"</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_vectortranslate</span>(<span class="st">"data/bbbike_Leipzig.osm.pbf"</span>, <span class="at">layer =</span> <span class="st">"multipolygons"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">extra_tags =</span> <span class="fu">c</span>(<span class="st">"shop"</span>, <span class="st">"amenity"</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_vectortranslate</span>(<span class="st">"data/bbbike_Leipzig.osm.pbf"</span>, </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">layer =</span> <span class="st">"lines"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">extra_tags =</span> <span class="fu">c</span>(<span class="st">"highway"</span>, <span class="st">"cycleway"</span>, <span class="st">"bicycle"</span>, <span class="st">"foot"</span>, <span class="st">"vehicle"</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"cycleway:both"</span>, <span class="st">"cycleway:left"</span>, <span class="st">"cycleway:right"</span>, </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"bicycle_road"</span>, <span class="st">"cyclestreet"</span>, <span class="st">"oneway"</span>, <span class="st">"surface"</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"network"</span>, <span class="st">"shop"</span>, <span class="st">"amenity"</span>))</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>osmextract<span class="sc">::</span><span class="fu">oe_vectortranslate</span>(<span class="st">"data/bbbike_Leipzig.osm.pbf"</span>, </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">layer =</span> <span class="st">"multilinestrings"</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">extra_tags =</span> <span class="fu">c</span>(<span class="st">"network"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having it prepared we can check what’s there:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_layers</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>, <span class="at">do_count =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Driver: GPKG 
Available layers:
        layer_name     geometry_type features fields
1    multipolygons     Multi Polygon   574267     26
2 multilinestrings Multi Line String     1427      5
3           points             Point   264815     12
4            lines       Line String   288025     23
5         highways                     109257     14
                             crs_name
1                              WGS 84
2                              WGS 84
3                              WGS 84
4                              WGS 84
5 DHDN / 3-degree Gauss-Kruger zone 4</code></pre>
</div>
</div>
<p>As the data provided by BBBike.org covers the whole bounding box surrounding Leipzig, we have to find a city boundary and cut off the data outside. We will read all lines, select particular columns, cut by boundary and store in the <code>.gpkg</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>leipzig_border <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">query =</span> <span class="st">"SELECT name, geometry FROM multipolygons \</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="st">                      WHERE boundary = 'administrative' AND \</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="st">                      admin_level = 6 AND \</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="st">                      name = 'Leipzig'"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:31468"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>hw <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"data/bbbike_Leipzig.gpkg"</span>, <span class="at">layer =</span> <span class="st">"lines"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"osm_id"</span>, <span class="st">"name"</span>, <span class="st">"highway"</span>, <span class="st">"foot"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"bicycle"</span>, <span class="st">"cycleway"</span>)), <span class="st">"oneway"</span>, </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"surface"</span>, <span class="st">"vehicle"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:31468"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(leipzig_border)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(hw, <span class="at">dsn =</span> <span class="st">"data/bbbike_Leipzig.gpkg"</span>, <span class="at">layer =</span> <span class="st">"highways"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the highways prepared, we can run simple analysis: count the length of the roads for bikes, bikes + pedestrians, and cars only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>bikes_only <span class="ot">&lt;-</span> hw <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(highway <span class="sc">==</span> <span class="st">"cycleway"</span> <span class="sc">|</span> cycleway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"lane"</span>, <span class="st">"track"</span>, <span class="st">"yes"</span>) <span class="sc">|</span> bicycle <span class="sc">==</span> <span class="st">"designated"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>((bicycle_road))) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geometry)) <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">length =</span> units<span class="sc">::</span><span class="fu">set_units</span>(sf<span class="sc">::</span><span class="fu">st_length</span>(geometry), <span class="st">"km"</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">category =</span> <span class="st">"Bikes only"</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>bikes_ped <span class="ot">&lt;-</span> hw <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"path"</span>, <span class="st">"footway"</span>) <span class="sc">&amp;</span> bicycle <span class="sc">==</span> <span class="st">"designated"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geometry)) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">length =</span> units<span class="sc">::</span><span class="fu">set_units</span>(sf<span class="sc">::</span><span class="fu">st_length</span>(geometry), <span class="st">"km"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">category =</span> <span class="st">"Bikes + Pedestrians"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>cars_only <span class="ot">&lt;-</span> hw <span class="sc">|&gt;</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">is.na</span>(highway) <span class="sc">&amp;</span> <span class="sc">!</span>highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"cycleway"</span>, <span class="st">"path"</span>, <span class="st">"footway"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(cycleway_left) <span class="sc">|</span> <span class="fu">is.na</span>(cycleway_right)) <span class="sc">|&gt;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geometry)) <span class="sc">|&gt;</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">length =</span> units<span class="sc">::</span><span class="fu">set_units</span>(sf<span class="sc">::</span><span class="fu">st_length</span>(geometry), <span class="st">"km"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">category =</span> <span class="st">"Cars only"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>bikes_only <span class="sc">|&gt;</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(bikes_ped) <span class="sc">|&gt;</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(cars_only) <span class="sc">|&gt;</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">l =</span> <span class="st">"Total length"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> category, <span class="at">values_from =</span> length) <span class="sc">|&gt;</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span><span class="fu">format</span>(<span class="fu">round</span>(.x, <span class="dv">1</span>), <span class="at">nsmall =</span> <span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">escape =</span> F, <span class="at">linesep =</span> <span class="st">""</span>,</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col.names =</span> kableExtra<span class="sc">::</span><span class="fu">linebreak</span>(<span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Bikes only"</span>,</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>                                                      <span class="st">"Bikes + Pedestrians"</span>,</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>                                                      <span class="st">"Cars only"</span>), <span class="at">align =</span> <span class="st">"c"</span>),</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"crrr"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-bikes_pedestrians_cars" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bikes_pedestrians_cars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.7: Total length of roads by it’s type
</figcaption>
<div aria-describedby="tbl-bikes_pedestrians_cars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bikes only</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bikes + Pedestrians</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cars only</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Total length</td>
<td style="text-align: right;">367.7 [km]</td>
<td style="text-align: right;">234.0 [km]</td>
<td style="text-align: right;">3289.2 [km]</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>If you would like to split it by surface (asphalt, concrete, etc), then we can just group our highways by that column. <a href="#tbl-bike_only_by_surface" class="quarto-xref">Table&nbsp;<span>2.8</span></a> provides the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">"[ no data ]"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>hw <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(highway <span class="sc">==</span> <span class="st">"cycleway"</span> <span class="sc">|</span> cycleway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"lane"</span>, <span class="st">"track"</span>, <span class="st">"yes"</span>) <span class="sc">|</span> bicycle <span class="sc">==</span> <span class="st">"designated"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>((bicycle_road))) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(surface) <span class="sc">|&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">surface =</span> stringi<span class="sc">::</span><span class="fu">stri_replace_all_fixed</span>(</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>      surface, </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">"_"</span>, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> <span class="st">" "</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geometry)) <span class="sc">|&gt;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">length =</span> units<span class="sc">::</span><span class="fu">set_units</span>(sf<span class="sc">::</span><span class="fu">st_length</span>(geometry), <span class="st">"km"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  units<span class="sc">::</span><span class="fu">drop_units</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(length <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(length)) <span class="sc">|&gt;</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">linesep =</span> <span class="st">""</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Surface"</span>, <span class="st">"Length [km]"</span>),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"lr"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-bike_only_by_surface" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bike_only_by_surface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.8: Length of bike only roads by surface
</figcaption>
<div aria-describedby="tbl-bike_only_by_surface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Surface</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Length [km]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">asphalt</td>
<td style="text-align: right;">210.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">paving stones</td>
<td style="text-align: right;">54.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[ no data ]</td>
<td style="text-align: right;">48.84</td>
</tr>
<tr class="even">
<td style="text-align: left;">paved</td>
<td style="text-align: right;">20.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">compacted</td>
<td style="text-align: right;">13.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">fine gravel</td>
<td style="text-align: right;">3.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete:plates</td>
<td style="text-align: right;">3.58</td>
</tr>
<tr class="even">
<td style="text-align: left;">pebblestone</td>
<td style="text-align: right;">3.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sett</td>
<td style="text-align: right;">2.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">gravel</td>
<td style="text-align: right;">1.61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">concrete</td>
<td style="text-align: right;">1.38</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#fig-leipzig_plots" class="quarto-xref">Figure&nbsp;<span>2.18</span></a> visualizes road networks and it’s density.</p>
<div id="fig-leipzig_plots" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-leipzig_plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-leipzig_plots" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-leipzig_plots-1" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-leipzig_plots-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="osm_files/figure-html/fig-leipzig_plots-1.png" class="img-fluid figure-img column-body-outset" data-ref-parent="fig-leipzig_plots" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-leipzig_plots-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) for bikes
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-leipzig_plots" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-leipzig_plots-2" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-leipzig_plots-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="osm_files/figure-html/fig-leipzig_plots-2.png" class="img-fluid figure-img column-body-outset" data-ref-parent="fig-leipzig_plots" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-leipzig_plots-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) for cars
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-leipzig_plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.18: Highways in Leipzig
</figcaption>
</figure>
</div>
</section>
</section>
<section id="routing-and-accessibility" class="level3 page-columns page-full" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="routing-and-accessibility"><span class="header-section-number">2.4.2</span> Routing and accessibility</h3>
<p>But roads are not just lines on a map. It is also a network of connections that allow you to move from city to city, from one point to another. A network of connections that can be represented using graphs. It can be used both for routing and for analyzing the accessibility of various goods and resources: school, work or library.</p>
<p>There’s a lot of routing software on the market, both free and commercial, online and offline, which uses OSM and proprietary maps. The overview of those using OSM data can be found under <a href="https://wiki.openstreetmap.org/wiki/Routing/online_routers">https://wiki.openstreetmap.org/wiki/Routing/online_routers</a>. Some of them provides API, which may be used in various tools (R, QGIS), some of them like <a href="https://brouter.de/brouter/">BRouter</a> integrates with different Android based map software (<a href="http://osmand.net/">OSMAnd</a> for example). There is a PostGIS/PostgreSQL <a href="https://pgrouting.org/">pgRouting</a> library which extends geospatial database capabilities by routing functionality with various algorithms.</p>
<div class="page-columns page-full">
<div id="fig-qgis_ors_routes" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-qgis_ors_routes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/qgis_ors_routes.png" class="img-fluid figure-img column-body-outset">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-qgis_ors_routes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.19: Example of routes generated by openroutingservice.org using QGIS <a href="https://github.com/GIScience/orstools-qgis-plugin/wiki/">ORS plugin</a> for cars and bikes.
</figcaption>
</figure>
</div>
</div>
<p><a href="https://openrouteservice.org/">ORS</a> provides isochrones as well. Isochrones reflect the area/extent that can be reached within a given period of time. They are typically used to visualize reachability analysis, which is one of the fundamental tasks in urban planning. It can be used to measure the service area covered by schools, hospitals <span class="citation" data-cites="reinmuthPhysicalAccessibilityHospitals">(<a href="references.html#ref-reinmuthPhysicalAccessibilityHospitals" role="doc-biblioref">Reinmuth and Zipf, n.d.</a>)</span>, fire brigades, restaurants <span class="citation" data-cites="benhlimaIsochronicMeasurementAnalysis2023">(<a href="references.html#ref-benhlimaIsochronicMeasurementAnalysis2023" role="doc-biblioref">Benhlima et al. 2023</a>)</span> or train stations <span class="citation" data-cites="fazio15minutesStationCase2023">(<a href="references.html#ref-fazio15minutesStationCase2023" role="doc-biblioref">Fazio et al. 2023</a>)</span>. It is used to run multimodal transport analysis and to optimize public transport facilities <span class="citation" data-cites="bauerComputingIsochronesMultimodal2008 marciuskaDeterminingObjectsIsochrones2010 kondratevaIsochronesBasedPublic2017">(<a href="references.html#ref-bauerComputingIsochronesMultimodal2008" role="doc-biblioref">Bauer et al. 2008</a>; <a href="references.html#ref-marciuskaDeterminingObjectsIsochrones2010" role="doc-biblioref">Marciuska and Gamper 2010</a>; <a href="references.html#ref-kondratevaIsochronesBasedPublic2017" role="doc-biblioref">Kondrateva, Sidorov, and Saprykin 2017</a>)</span>. <a href="#fig-prusice_osp_access" class="quarto-xref">Figure&nbsp;<span>2.20</span></a> displays example of areas which can be reach-out by 3, 6, and 9 minutes from fire stations in Prusice municipality. The isochrones were provided by openroutingservice API using {openrouteservice} package <span class="citation" data-cites="openrouteservice">(<a href="references.html#ref-openrouteservice" role="doc-biblioref">Oleś 2024</a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fire_stations <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(b, <span class="at">timeout =</span> <span class="dv">60</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"amenity"</span>, <span class="at">value =</span> <span class="st">"fire_station"</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>()</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>osp <span class="ot">&lt;-</span> fire_stations<span class="sc">$</span>osm_polygons[, <span class="st">"amenity"</span> <span class="sc">==</span> <span class="st">"fire_station"</span>] <span class="sc">|&gt;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_centroid</span>()</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>osp <span class="ot">&lt;-</span> osp <span class="sc">|&gt;</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(prusice_mun)) <span class="sc">|&gt;</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(prusice_mun, <span class="at">.predicate=</span>sf<span class="sc">::</span>st_within)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">&lt;-</span> osp <span class="sc">|&gt;</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_coordinates</span>() <span class="sc">|&gt;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> openrouteservice<span class="sc">::</span><span class="fu">ors_isochrones</span>(<span class="at">locations =</span> loc, </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">60</span>, <span class="dv">6</span><span class="sc">*</span><span class="dv">60</span>, <span class="dv">9</span><span class="sc">*</span><span class="dv">60</span>), </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">api_key =</span> <span class="st">"5b3ce3597851110001cf6248ec03277a4e17441bb853daa715874de4"</span>,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">output =</span> <span class="st">"sf"</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>tm <span class="sc">+</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(iso) <span class="sc">+</span> </span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="st">"value"</span>, </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.scale =</span> tmap<span class="sc">::</span><span class="fu">tm_scale_discrete</span>(</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ticks =</span> <span class="fu">unique</span>(iso<span class="sc">$</span>value)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>                    ),</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill_alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">col_alpha =</span> <span class="dv">0</span>,</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">title =</span> <span class="st">"access in min"</span>,</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>),</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"top"</span>),</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bg.color =</span> <span class="st">"white"</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>                    ),</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(osp) <span class="sc">+</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-prusice_osp_access" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prusice_osp_access-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-prusice_osp_access-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prusice_osp_access-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.20: Areas reachable in 3, 6, and 9 minutes from fire stations in Prusice municipality.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="power-grid" class="level2 page-columns page-full" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="power-grid"><span class="header-section-number">2.5</span> Power grid</h2>
<p>OSM is not just roads. There are several other features mapped, one of them is power grid. You can see the grid features mapped on <a href="https://openinframap.org/#6.13/57.227/14.383/L,P,S">Open Infrastructure Map</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">''</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="st">"https://taginfo.openstreetmap.org/api/4/key/values?key=power&amp;filter=all&amp;lang=en&amp;sortname=count&amp;sortorder=desc&amp;rp=10&amp;page=1"</span>, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(value, count, fraction, description)) <span class="sc">|&gt;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">decimal.mark =</span> <span class="st">"."</span>, <span class="at">big.mark =</span> <span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_classic_2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-grid_featues" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-grid_featues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.9: 10 most popular <code>power=</code> values in OpenStreetMap
</figcaption>
<div aria-describedby="tbl-grid_featues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="lightable-classic-2 do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fraction</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">tower</td>
<td style="text-align: right;">16089907</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: left;">A tower or pylon carrying high voltage electricity cables. Often constructed from steel latticework but tubular or solid pylons are also used.</td>
</tr>
<tr class="even">
<td style="text-align: left;">pole</td>
<td style="text-align: right;">13189726</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: left;">A single pole supporting power lines, often a wood, steel, or concrete mast designed to carry minor power lines.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">generator</td>
<td style="text-align: right;">2508120</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">A device which converts one form of energy to another, for example, an electrical generator.</td>
</tr>
<tr class="even">
<td style="text-align: left;">line</td>
<td style="text-align: right;">922709</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">High-voltage power lines used for power transmission, usually supported by towers or pylons</td>
</tr>
<tr class="odd">
<td style="text-align: left;">minor_line</td>
<td style="text-align: right;">883016</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Minor power lines forming the distribution grid, usually carried by poles.</td>
</tr>
<tr class="even">
<td style="text-align: left;">substation</td>
<td style="text-align: right;">661210</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">A facility which controls the flow of electricity in a power network with transformers, switchgear or compensators.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">portal</td>
<td style="text-align: right;">195721</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">A supporting structure for power lines, composed of vertical legs with cables between them attached to a horizontal crossarm.</td>
</tr>
<tr class="even">
<td style="text-align: left;">transformer</td>
<td style="text-align: right;">180990</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">A device for stepping up or down electric voltage. Large power transformers are typically located inside substations</td>
</tr>
<tr class="odd">
<td style="text-align: left;">catenary_mast</td>
<td style="text-align: right;">176976</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">A pole supporting the overhead wires used to supply electricity to vehicles equipped with a pantograph such as trams and trains</td>
</tr>
<tr class="even">
<td style="text-align: left;">switch</td>
<td style="text-align: right;">111941</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">A device which allows electrical network operators to power up &amp; down lines and transformers in substations or along the power grid.</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>This section is inspired by OpenData StackExchange <a href="https://opendata.stackexchange.com/questions/19973/is-there-a-publicly-accessible-map-of-the-swedish-medium-voltage-electricity-gri/20658#20658">question</a>. The queries are build around <code>power</code> tag. A very similar approach can be applied for oil and gas pipelines or other utilities. For details of usage see <a href="https://wiki.openstreetmap.org/wiki/Oil_and_Gas_Infrastructure">oil and gas infrastructure</a> or <a href="https://wiki.openstreetmap.org/wiki/Tag:man_made%3Dpipeline"><code>pipeline</code></a> tag.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Other sources of open data for power transmission lines are listed on <a href="https://wiki.openmod-initiative.org/wiki/Transmission_network_datasets">openmod</a>.</p>
</div></div><div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">getbb</span>(<span class="st">"Sweden"</span>, <span class="at">featuretype =</span> <span class="st">"country"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>sw <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(bbox, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"boundary"</span>, <span class="at">value =</span> <span class="st">"administrative"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"admin_level"</span>, <span class="at">value =</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"name:en"</span>, <span class="at">value =</span> <span class="st">"Sweden"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unique_osmdata</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unname_osmdata_sf</span>()</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>sw_boundary <span class="ot">&lt;-</span> sw<span class="sc">$</span>osm_multipolygons[sw<span class="sc">$</span>osm_multipolygons<span class="sc">$</span><span class="st">`</span><span class="at">ISO3166-1</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"SE"</span>,][, <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"geometry"</span>)]</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> osmdata<span class="sc">::</span><span class="fu">opq</span>(bbox, <span class="at">timeout =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"power"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">osmdata_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  osmdata<span class="sc">::</span><span class="fu">unique_osmdata</span>()</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> p<span class="sc">$</span>osm_lines <span class="sc">|&gt;</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(power <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"cable"</span>, <span class="st">"line"</span>, <span class="st">"minor_line"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(sw_boundary) <span class="sc">|&gt;</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"voltage"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(voltage) <span class="sc">|&gt;</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">voltage =</span> <span class="fu">as.numeric</span>(voltage)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>substations <span class="ot">&lt;-</span> p<span class="sc">$</span>osm_polygons <span class="sc">|&gt;</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(sw_boundary) <span class="sc">|&gt;</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(power <span class="sc">==</span> <span class="st">"substation"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"power"</span>, <span class="st">"voltage"</span>, <span class="st">"name"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(voltage) <span class="sc">|&gt;</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">voltage =</span> <span class="fu">as.numeric</span>(voltage)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>substations <span class="ot">&lt;-</span> p<span class="sc">$</span>osm_points <span class="sc">|&gt;</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_filter</span>(sw_boundary) <span class="sc">|&gt;</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(power <span class="sc">==</span> <span class="st">"substation"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(<span class="st">"osm_id"</span>, <span class="st">"power"</span>, <span class="st">"voltage"</span>, <span class="st">"name"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(voltage) <span class="sc">|&gt;</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">voltage =</span> <span class="fu">as.numeric</span>(voltage)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(substations)</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(sw_boundary) <span class="sc">+</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"gray95"</span>) <span class="sc">+</span></span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(grid) <span class="sc">+</span></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_lines</span>(<span class="st">"voltage"</span>, <span class="at">col.legend =</span> tmap<span class="sc">::</span><span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Power grid [kV]"</span>)) <span class="sc">+</span></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>(substations) <span class="sc">+</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_dots</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-power_grid_sweden" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-power_grid_sweden-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="osm_files/figure-html/fig-power_grid_sweden-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-power_grid_sweden-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.21: Power grid of Sweden
</figcaption>
</figure>
</div>
</div>
</div>
<!--
#TODO https://gis.stackexchange.com/questions/474669/qgis-finding-intersection-of-points-and-lines-layers-in-electricity-grid
-->
<!---
## Addresses
https://taginfo.openstreetmap.org/search?q=addr
addr::housenumber + addr::street : punkty + budynki
może być associated_street (w relacji)
miasto, gmina - moze być w danych administracyjnych


Z adresami związany geocoding i reversal - Nominatim + pakiety do tego

#TODO przejrzeć https://gis.stackexchange.com/questions/95919/determining-accessibility-of-u-s-street-address

--->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bauerComputingIsochronesMultimodal2008" class="csl-entry" role="listitem">
Bauer, Veronika, Johann Gamper, Roberto Loperfido, Sylvia Profanter, Stefan Putzer, and Igor Timko. 2008. <span>“Computing Isochrones in Multi-Modal, Schedule-Based Transport Networks.”</span> In <em>Proceedings of the 16th <span>ACM SIGSPATIAL</span> International Conference on <span>Advances</span> in Geographic Information Systems</em>, 1–2. <span>GIS</span> ’08. <span>New York, NY, USA</span>: <span>Association for Computing Machinery</span>. <a href="https://doi.org/b9xqfg">https://doi.org/b9xqfg</a>.
</div>
<div id="ref-benhlimaIsochronicMeasurementAnalysis2023" class="csl-entry" role="listitem">
Benhlima, Ouidad, Fouad Riane, Jakob Puchinger, and Hicham Bahi. 2023. <span>“An Isochronic Measurement for the Analysis of Proximity to Restaurants and Locations of Food Delivery Parking.”</span> In <em>The 9th <span>International Conference</span> on <span>Modeling</span>, <span>Simulation</span> and <span>Applied Optimization</span> (<span>ICMSAO</span>’23)</em>. <span>Marrakech (Maroc), Morocco</span>. <a href="https://hal.science/hal-04086908">https://hal.science/hal-04086908</a>.
</div>
<div id="ref-spData" class="csl-entry" role="listitem">
Bivand, Roger, Jakub Nowosad, and Robin Lovelace. 2023. <em>spData: Datasets for Spatial Analysis</em>. <a href="https://CRAN.R-project.org/package=spData">https://CRAN.R-project.org/package=spData</a>.
</div>
<div id="ref-estimaExploratoryAnalysisOpenStreetMap2013" class="csl-entry" role="listitem">
Estima, Jacinto, and Marco Painho. 2013. <span>“Exploratory Analysis of <span>OpenStreetMap</span> for Land Use Classification.”</span> In <em>Proceedings of the Second <span>ACM SIGSPATIAL</span> International Workshop on Crowdsourced and Volunteered Geographic Information</em>, 39–46. <a href="https://doi.org/10.1145/2534732.2534734">https://doi.org/10.1145/2534732.2534734</a>.
</div>
<div id="ref-estimaInvestigatingPotentialOpenstreetmap2015" class="csl-entry" role="listitem">
———. 2015. <span>“Investigating the <span>Potential</span> of <span>Openstreetmap</span> for <span>Land Use</span>/<span>Land Cover Production</span>: <span>A Case Study</span> for <span>Continental Portugal</span>.”</span> In <em><span>OpenStreetMap</span> in <span>GIScience</span>: <span>Experiences</span>, <span>Research</span>, and <span>Applications</span></em>, edited by Jamal Jokar Arsanjani, Alexander Zipf, Peter Mooney, and Marco Helbich, 273–93. <span>Cham</span>: <span>Springer International Publishing</span>. <a href="https://doi.org/10.1007/978-3-319-14280-7_14">https://doi.org/10.1007/978-3-319-14280-7_14</a>.
</div>
<div id="ref-fazio15minutesStationCase2023" class="csl-entry" role="listitem">
Fazio, Martina, Fabio Borghetti, Nadia Giuffrida, Michela Le Pira, Michela Longo, Matteo Ignaccolo, Giuseppe Inturri, and Roberto Maja. 2023. <span>“The <span>‘15-Minutes Station’</span>: A Case Study to Evaluate the Pedestrian Accessibility of Railway Transport in <span>Southern Italy</span>.”</span> <em>Transportation Research Procedia</em>, <span>AIIT</span> 3rd <span>International Conference</span> on <span>Transport Infrastructure</span> and <span>Systems</span> (<span>TIS ROMA</span> 2022), 15th-16th <span>September</span> 2022, <span>Rome</span>, <span>Italy</span>, 69 (January): 536–43. <a href="https://doi.org/gtg74p">https://doi.org/gtg74p</a>.
</div>
<div id="ref-fonteUsingOpenStreetMapCreate2019" class="csl-entry" role="listitem">
Fonte, Cid’alia Costa, Joaquim Ant’onio Patriarca, Marco Minghini, Vyron Antoniou, Linda See, and Maria Antonia Brovelli. 2019. <span>“Using <span>OpenStreetMap</span> to <span>Create Land Use</span> and <span>Land Cover Maps</span>: <span>Development</span> of an <span>Application</span>.”</span> In <em>Geospatial <span>Intelligence</span>: <span>Concepts</span>, <span>Methodologies</span>, <span>Tools</span>, and <span>Applications</span> (3 <span>Volumes</span>)</em>, edited by Information Resources Management Association, 1100–1123. <span>Hershey PA, USA</span>: <span>IGI Global</span>. <a href="https://www.igi-global.com/book/geospatial-intelligence-concepts-methodologies-tools/213224">https://www.igi-global.com/book/geospatial-intelligence-concepts-methodologies-tools/213224</a>.
</div>
<div id="ref-osmextract" class="csl-entry" role="listitem">
Gilardi, Andrea, and Robin Lovelace. 2023. <em>Osmextract: Download and Import Open Street Map Data Extracts</em>. <a href="https://CRAN.R-project.org/package=osmextract">https://CRAN.R-project.org/package=osmextract</a>.
</div>
<div id="ref-girresQualityAssessmentFrench2010" class="csl-entry" role="listitem">
Girres, Jean?François, and Guillaume Touya. 2010. <span>“Quality Assessment of the French <span>OpenStreetMap</span> Dataset.”</span> <em>Transactions in GIS</em> 14 (4): 435–59. <a href="https://doi.org/10.1111/j.1467-9671.2010.01203.x">https://doi.org/10.1111/j.1467-9671.2010.01203.x</a>.
</div>
<div id="ref-haklayHowGoodVolunteered2010" class="csl-entry" role="listitem">
Haklay, Mordechai. 2010. <span>“How Good Is Volunteered Geographical Information? <span>A</span> Comparative Study of <span>OpenStreetMap</span> and Ordnance Survey Datasets.”</span> <em>Environment and Planning B: Planning and Design</em> 37 (4): 682–703. <a href="https://doi.org/10.1068/b35097">https://doi.org/10.1068/b35097</a>.
</div>
<div id="ref-geodata" class="csl-entry" role="listitem">
Hijmans, Robert J., M’arcia Barbosa, Aniruddha Ghosh, and Alex Mandel. 2023. <em>Geodata: Download Geographic Data</em>. <a href="https://CRAN.R-project.org/package=geodata">https://CRAN.R-project.org/package=geodata</a>.
</div>
<div id="ref-kondratevaIsochronesBasedPublic2017" class="csl-entry" role="listitem">
Kondrateva, Elena, Alexander Sidorov, and Oleg Saprykin. 2017. <span>“An Isochrones Based Public Transport Stops Optimization Technique.”</span> In <em>2017 5th <span>IEEE International Conference</span> on <span>Models</span> and <span>Technologies</span> for <span>Intelligent Transportation Systems</span> (<span>MT-ITS</span>)</em>, 182–87. <a href="https://doi.org/gtg72p">https://doi.org/gtg72p</a>.
</div>
<div id="ref-kounadiAssessingQualityOpenStreetMap2009" class="csl-entry" role="listitem">
Kounadi, Ourania. 2009. <span>“Assessing the <span>Quality</span> of <span>OpenStreetMap Data</span>.”</span> <span>London</span>: <span>University College of London, Department of Civil, Environmental And Geomatic Engineering</span>.
</div>
<div id="ref-ludwigComparisonStreetNetworks2011" class="csl-entry" role="listitem">
Ludwig, Ina, Angi Voss, and Maike Krause-Traudes. 2011. <span>“A Comparison of the Street Networks of Navteq and <span>OSM</span> in Germany.”</span> In <em>Advancing Geoinformation Science for a Changing World</em>, 65–84. <a href="https://doi.org/10.1007/978-3-642-19789-5_4">https://doi.org/10.1007/978-3-642-19789-5_4</a>.
</div>
<div id="ref-marciuskaDeterminingObjectsIsochrones2010" class="csl-entry" role="listitem">
Marciuska, Sarunas, and Johann Gamper. 2010. <span>“Determining Objects Within Isochrones in Spatial Network Databases.”</span> In <em>Proceedings of the 14th East <span>European</span> Conference on <span>Advances</span> in Databases and Information Systems</em>, 392–405. <span>ADBIS</span>’10. <span>Berlin, Heidelberg</span>: <span>Springer-Verlag</span>.
</div>
<div id="ref-osmdata" class="csl-entry" role="listitem">
Mark Padgham, Bob Rudis, Robin Lovelace, and Maëlle Salmon. 2017. <span>“Osmdata.”</span> <em>Journal of Open Source Software</em> 2 (14): 305. <a href="https://doi.org/10.21105/joss.00305">https://doi.org/10.21105/joss.00305</a>.
</div>
<div id="ref-mooneyStudyDataRepresentation2010" class="csl-entry" role="listitem">
Mooney, Peter, Padraig Corcoran, and Adam Winstanley. 2010. <span>“A Study of Data Representation of Natural Features in <span>OpenStreetMap</span>.”</span> In. <span>Zurich</span>. <a href="https://giscience2010.org/">https://giscience2010.org/</a>.
</div>
<div id="ref-neisStreetNetworkEvolution2011" class="csl-entry" role="listitem">
Neis, Pascal, Dennis Zielstra, and Alexander Zipf. 2011. <span>“The Street Network Evolution of Crowdsourced Maps: <span>OpenStreetMap</span> in Germany 2007–2011.”</span> <em>Future Internet</em> 4 (1): 1–21. <a href="https://doi.org/10.3390/fi4010001">https://doi.org/10.3390/fi4010001</a>.
</div>
<div id="ref-openrouteservice" class="csl-entry" role="listitem">
Oleś, Andrzej. 2024. <em>Openrouteservice: Openrouteservice API Client</em>. <a href="https://github.com/GIScience/openrouteservice-r">https://github.com/GIScience/openrouteservice-r</a>.
</div>
<div id="ref-units" class="csl-entry" role="listitem">
Pebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. <span>“Measurement Units in <span>R</span>.”</span> <em>R Journal</em> 8 (2): 486–94. <a href="https://doi.org/10.32614/RJ-2016-061">https://doi.org/10.32614/RJ-2016-061</a>.
</div>
<div id="ref-PlanetOSM" class="csl-entry" role="listitem">
<span>“Planet <span>OSM</span>.”</span> 2024. 2024. <a href="https://planet.osm.org/">https://planet.osm.org/</a>.
</div>
<div id="ref-reinmuthPhysicalAccessibilityHospitals" class="csl-entry" role="listitem">
Reinmuth, Marcel, and Alexander Zipf. n.d. <span>“Physical Accessibility of Hospitals in Sub-<span>Saharan Africa</span>: <span>An</span> Exemplary Analysis of the Potential of Open Geodata in the Health Sector.”</span>
</div>
<div id="ref-schottOpenstreetmapElementVectorisation2022a" class="csl-entry" role="listitem">
Schott, M., S. Lautenbach, L. Größchen, and A. Zipf. 2022. <span>“Openstreetmap Element Vectorisation - a Tool for High Resolution Data Insights and Its Usability in the Land-Use and Land-Cover Domain.”</span> <em>The International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences</em> XLVIII-4-W1-2022 (August): 395–402. <a href="https://doi.org/gtdww7">https://doi.org/gtdww7</a>.
</div>
<div id="ref-schultzOpenLandCover2017a" class="csl-entry" role="listitem">
Schultz, Michael, Janek Voss, Michael Auer, Sarah Carter, and Alexander Zipf. 2017. <span>“Open Land Cover from <span>OpenStreetMap</span> and Remote Sensing.”</span> <em>International Journal of Applied Earth Observation and Geoinformation</em> 63 (December): 206–13. <a href="https://doi.org/gddfn6">https://doi.org/gddfn6</a>.
</div>
<div id="ref-WikidataR" class="csl-entry" role="listitem">
Shafee, Thomas, Os Keyes, and Serena Signorelli. 2021. <em>WikidataR: Read-Write API Client Library for Wikidata</em>. <a href="https://CRAN.R-project.org/package=WikidataR">https://CRAN.R-project.org/package=WikidataR</a>.
</div>
<div id="ref-rnaturalearthdata" class="csl-entry" role="listitem">
South, Andy. 2017. <em>Rnaturalearthdata: World Vector Map Data from Natural Earth Used in ’Rnaturalearth’</em>. <a href="https://CRAN.R-project.org/package=rnaturalearthdata">https://CRAN.R-project.org/package=rnaturalearthdata</a>.
</div>
<div id="ref-tmap" class="csl-entry" role="listitem">
Tennekes, Martijn. 2018. <span>“<span class="nocase">tmap</span>: Thematic Maps in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 84 (6): 1–39. <a href="https://doi.org/10.18637/jss.v084.i06">https://doi.org/10.18637/jss.v084.i06</a>.
</div>
<div id="ref-underdarkGuideAdvancedLabeling2011" class="csl-entry" role="listitem">
underdark. 2011a. <span>“Guide to <span>Advanced Labeling</span> for <span>OSM Roads</span>.”</span> <span>Free and Open Source GIS Ramblings</span>. September 13, 2011. <a href="https://anitagraser.com/2011/09/13/guide-to-advanced-labeling-for-osm-roads/">https://anitagraser.com/2011/09/13/guide-to-advanced-labeling-for-osm-roads/</a>.
</div>
<div id="ref-underdarkGoogleMapsStyle2011" class="csl-entry" role="listitem">
———. 2011b. <span>“<span>‘<span>Google Maps</span>’</span>-<span>Style Road Maps</span> in <span>QGIS</span>.”</span> <span>Free and Open Source GIS Ramblings</span>. September 16, 2011. <a href="https://anitagraser.com/2011/09/16/google-maps-styled-road-maps-in-qgis/">https://anitagraser.com/2011/09/16/google-maps-styled-road-maps-in-qgis/</a>.
</div>
<div id="ref-underdarkGuideGoogleMapslikeMaps2014" class="csl-entry" role="listitem">
———. 2014. <span>“A Guide to <span class="nocase">GoogleMaps-like</span> Maps with <span>OSM</span> in <span>QGIS</span>.”</span> <span>Free and Open Source GIS Ramblings</span>. May 31, 2014. <a href="https://anitagraser.com/2014/05/31/a-guide-to-googlemaps-like-maps-with-osm-in-qgis/">https://anitagraser.com/2014/05/31/a-guide-to-googlemaps-like-maps-with-osm-in-qgis/</a>.
</div>
<div id="ref-zielstraQuantitativeStudiesData2010" class="csl-entry" role="listitem">
Zielstra, Dennis, and Alexander Zipf. 2010. <span>“Quantitative <span>Studies</span> on the <span>Data Quality</span> of <span>OpenStreetMap</span> in <span>Germany</span>.”</span> In. <a href="https://www.semanticscholar.org/paper/Quantitative-Studies-on-the-Data-Quality-of-in-Zielstra-Zipf/1c1c90197c081de1b9cba3f53d2ead9906a1d730">https://www.semanticscholar.org/paper/Quantitative-Studies-on-the-Data-Quality-of-in-Zielstra-Zipf/1c1c90197c081de1b9cba3f53d2ead9906a1d730</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>replaced by ISO 19157:2013<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>see <a href="https://www.naturalearthdata.com/">www.naturalearthdata.com</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>available on <a href="https://osmdata.openstreetmap.de/data/water-polygons.html">osmdata.openstreetmap.de</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You can use <code>dplyr::filter()</code> as well.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Other option would be load all fields including <code>other_tags</code> (which are like <code>hstore</code> type field in Postgresql) and then massage it a bit with <code>tidyverse</code> functions:</p>
<pre>  l &lt;- osmextract::oe_read("data/bbbike_Leipzig.gpkg", 
         query = "SELECT * FROM multipolygons WHERE boundary = 'postal_code'")

  l |&gt;
    subset(select = other_tags) |&gt;
    tidyr::separate_rows(other_tags, sep = ",") |&gt;
    tidyr::separate(other_tags, into = c("key", "value"), sep = "=&gt;") |&gt;
    dplyr::mutate_at(c("key", "value"), stringr::str_remove_all, '"') |&gt;
    tidyr::pivot_wider(names_from = "key", values_from = "value")
  </pre>
<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn6"><p>It’s a extension of <a href="https://gis.stackexchange.com/questions/473142/how-to-extract-also-a-zip-code-with-overpass-turbo/474765#474765">GIS Stackexchange answer</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>All signs shared from Wikimedia commons. For similar signs in other European countries have a look on <a href="https://en.wikipedia.org/wiki/Comparison_of_European_road_signs">Comparison of European road signs</a>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>For details see <a href="https://wiki.openstreetmap.org/wiki/Key:bicycle_road">Key:bicycle_road</a><a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p><a href="https://wiki.openstreetmap.org/wiki/Cycle_routes">https://wiki.openstreetmap.org/wiki/Cycle_routes</a><a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p><a href="https://wiki.openstreetmap.org/wiki/Relation">https://wiki.openstreetmap.org/wiki/Relation</a><a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/gsapijaszko\.github\.io\/open_data\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="gsapijaszko/open_data" data-repo-id="R_kgDOLHf5ig" data-category="General" data-category-id="DIC_kwDOLHf5is4CdTas" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./environments.html" class="pagination-link" aria-label="Environmental data">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Environmental data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/gsapijaszko/open_data/edit/main/osm.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/gsapijaszko/open_data/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>